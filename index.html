<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Challenge & Change - Anne Hawkins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style media="screen" type="text/css">
        body {
            font-family: Georgia, sans-serif;
            font-weight: lighter;
        }
        h1 {
            text-align: center;
            font-weight: lighter;
        }
        .container {
            display: block;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        a {
            color: rgb(48, 48, 48);
            line-height: 1.7em;
            font-size: 13pt;
            text-decoration-line: none
        }
        p {
            color: rgb(107, 107, 107);
            line-height: 1.7em;
            font-size: 13pt;
        }
        p {
            opacity: 0.0;
            transition: opacity 1.0s;
        }
        p.show {
            opacity: 1.0;
        }
        p.choice {
            text-align: center;
        }
        a:hover {
            color: black;
            text-decoration-line: underline
        }
    </style>
</head>
<body>
    <div id="story" class="container">
        <a href="#" onclick="window.location.reload(true);">
            <h1>Challenge & Change - Anne Hawkins</h1>
        </a>
    </div>
    <!-- ink.js -->
    <script language="javascript" type="text/javascript">
        // ink.js
        (function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("inkjs",["exports"],e):e(t.inkjs=t.inkjs||{})})(this,function(t){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(){function t(){n(this,t),this._isRelative,this._components=[],"string"==typeof arguments[0]?this.componentsString=arguments[0]:arguments[0]instanceof l&&arguments[1]instanceof t?(this._components.push(arguments[0]),this._components=this._components.concat(arguments[1])):arguments[0]instanceof Array&&(this._components=this._components.concat(arguments[0]),this._isRelative=!!arguments[1])}return a(t,[{key:"PathByAppendingPath",value:function(e){for(var n=new t,i=0,a=0;a<e.components.length&&e.components[a].isParent;++a)i++;for(var a=0;a<this.components.length-i;++a)n.components.push(this.components[a]);for(var a=i;a<e.components.length;++a)n.components.push(e.components[a]);return n}},{key:"toString",value:function(){return this.componentsString}},{key:"Equals",value:function(t){if(null==t)return!1;if(t.components.length!=this.components.length)return!1;if(t.isRelative!=this.isRelative)return!1;for(var e=0,n=t.components.length;e<n;e++)if(!t.components[e].Equals(this.components[e]))return!1;return!0}},{key:"isRelative",get:function(){return this._isRelative}},{key:"components",get:function(){return this._components}},{key:"head",get:function(){return this.components.length>0?this.components[0]:null}},{key:"tail",get:function(){if(this.components.length>=2){var e=this.components.slice(1,this.components.length);return new t(e)}return t.self}},{key:"length",get:function(){return this.components.length}},{key:"lastComponent",get:function(){return this.components.length>0?this.components[this.components.length-1]:null}},{key:"containsNamedComponent",get:function(){for(var t=0,e=this.components.length;t<e;t++)if(!this.components[t].isIndex)return!0;return!1}},{key:"componentsString",get:function(){var t=this.components.join(".");return this.isRelative?"."+t:t},set:function(t){var e=this;this.components.length=0;var n=t;if(null!=n&&""!=n){"."==n[0]&&(this._isRelative=!0,n=n.substring(1));var i=n.split(".");i.forEach(function(t){/^(\-|\+)?([0-9]+|Infinity)$/.test(t)?e.components.push(new l(parseInt(t))):e.components.push(new l(t))})}}}],[{key:"self",get:function(){var e=new t;return e._isRelative=!0,e}}]),t}(),l=function(){function t(e){n(this,t),"string"==typeof e?(this._index=-1,this._name=e):(this._index=parseInt(e),this._name=null)}return a(t,[{key:"toString",value:function(){return this.isIndex?this.index.toString():this.name}},{key:"Equals",value:function(t){return null!=t&&t.isIndex==this.isIndex&&(this.isIndex?this.index==t.index:this.name==t.name)}},{key:"index",get:function(){return this._index}},{key:"name",get:function(){return this._name}},{key:"isIndex",get:function(){return this.index>=0}},{key:"isParent",get:function(){return this.name==u.parentId}}],[{key:"ToParent",value:function(){return new t(u.parentId)}}]),t}();u.parentId="^",u.Component=l;var h=function(){function t(){n(this,t),this.parent=null,this._path=null}return a(t,[{key:"ResolvePath",value:function(t){if(t.isRelative){var e=this;return e instanceof _==!1&&(null==this.parent&&console.warn("Can't resolve relative path because we don't have a parent"),e=this.parent,"Container"!==e.constructor.name&&console.warn("Expected parent to be a container"),t=t.tail),e.ContentAtPath(t)}return this.rootContentContainer.ContentAtPath(t)}},{key:"ConvertPathToRelative",value:function(t){for(var e=this.path,n=Math.min(t.components.length,e.components.length),i=-1,a=0;a<n;++a){var r=e.components[a],o=t.components[a];if(!r.Equals(o))break;i=a}if(i==-1)return t;for(var s=e.components.length-1-i,l=[],h=0;h<s;++h)l.push(u.Component.ToParent());for(var c=i+1;c<t.components.length;++c)l.push(t.components[c]);var f=new u(l,!0);return f}},{key:"CompactPathString",value:function(t){var e=null,n=null;if(t.isRelative)n=t.componentsString,e=this.path.PathByAppendingPath(t).componentsString;else{var i=this.ConvertPathToRelative(t);n=i.componentsString,e=t.componentsString}return n.Length<e.Length?n:e}},{key:"Copy",value:function(){throw"Not Implemented"}},{key:"SetChild",value:function(t,e,n){t[e]&&(t[e]=null),t[e]=n,t[e]&&(t[e].parent=this)}},{key:"path",get:function(){if(null==this._path)if(null==this.parent)this._path=new u;else{for(var t=[],e=this,n=e.parent;n instanceof _;){var i=e;i.name&&i.hasValidName?t.unshift(new u.Component(i.name)):t.unshift(new u.Component(n.content.indexOf(e))),e=n,n=n.parent}this._path=new u(t)}return this._path}},{key:"rootContentContainer",get:function(){for(var t=this;t.parent;)t=t.parent;return t}}]),t}(),c=function(){function t(e){n(this,t),e="undefined"!=typeof e?e.toString():"",this._string=e}return a(t,[{key:"Append",value:function(t){this._string+=t}},{key:"AppendLine",value:function(t){"undefined"!=typeof t&&this.Append(t),this._string+="\n"}},{key:"AppendFormat",value:function(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}},{key:"toString",value:function(){return this._string}},{key:"Length",get:function(){return this._string.length}}]),t}(),f=function(){function t(e,i){if(n(this,t),void 0!==i)this.originName=e,this.itemName=i;else{var a=e.toString().split(".");this.originName=a[0],this.itemName=a[1]}}return a(t,[{key:"isNull",value:function(){return null==this.originName&&null==this.itemName}},{key:"toString",value:function(){return this.fullname}},{key:"Equals",value:function(e){if(e instanceof t){var n=e;return n.itemName==this.itemName&&n.originName==this.originName}return!1}},{key:"toString",value:function(){var t="0",e=this.itemName?this.itemName.toString():"null";return null!=this.originName&&(t=this.originName.toString()),t+e}},{key:"fullName",get:function(){return(null!==this.originName?this.originName:"?")+"."+this.itemName}}],[{key:"Null",value:function(){return new t(null,null)}}]),t}(),v=function(){function t(e,i){var a=this;if(n(this,t),this._keys={},this._values={},this.origins=null,this._originNames=null,e)if(e instanceof t){var r=e;r.forEach(function(t){a.Add(t.Key,t.Value)}),this._originNames=r._originNames}else if("string"==typeof e){this.SetInitialOriginName(e);var o=null;if(!(o=i.listDefinitions.TryGetDefinition(e,o)))throw new Error("InkList origin could not be found in story when constructing new list: "+singleOriginListName);this.origins=[o]}else if(e.hasOwnProperty("Key")&&e.hasOwnProperty("Value")){var s=e;this.Add(s.Key,s.Value)}}return a(t,[{key:"forEach",value:function(t){for(var e in this._values)t({Key:this._keys[e],Value:this._values[e]})}},{key:"AddItem",value:function(t){var e=this;if(t instanceof f){var n=t;if(null==n.originName)return void this.AddItem(n.itemName);throw this.origins.forEach(function(t){if(t.name==n.originName){var i;if(i=t.TryGetValueForItem(n,i),void 0!==i)return void e.Add(n,i);throw"Could not add the item "+n+" to this list because it doesn't exist in the original list definition in ink."}}),"Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found."}var i=t,a=null;if(this.origins.forEach(function(t){if(t.ContainsItemWithName(i)){if(null!=a)throw"Could not add the item "+i+" to this list because it could come from either "+t.name+" or "+a.name;a=t}}),null==a)throw"Could not add the item "+i+" to this list because it isn't known to any list definitions previously associated with this list.";var n=new f(a.name,i),r=a.ValueForItem(n);this.Add(n,r)}},{key:"ContainsItemNamed",value:function(t){var e=!1;return this.forEach(function(n){n.Key.itemName==t&&(e=!0)}),e}},{key:"ContainsKey",value:function(t){return t in this._values}},{key:"Add",value:function(t,e){this._keys[t]=t,this._values[t]=e}},{key:"Remove",value:function(t){delete this._values[t],delete this._keys[t]}},{key:"SetInitialOriginName",value:function(t){this._originNames=[t]}},{key:"SetInitialOriginNames",value:function(t){null==t?this._originNames=null:this._originNames=t.slice()}},{key:"Union",value:function(e){var n=new t(this);return e.forEach(function(t){n.Add(t.Key,t.Value)}),n}},{key:"Intersect",value:function(e){var n=new t;return this.forEach(function(t){e.ContainsKey(t.Key)&&n.Add(t.Key,t.Value)}),n}},{key:"Without",value:function(e){var n=new t(this);return e.forEach(function(t){n.Remove(t.Key)}),n}},{key:"Contains",value:function(t){var e=this,n=!0;return t.forEach(function(t){e.ContainsKey(t.Key)||(n=!1)}),n}},{key:"GreaterThan",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>t.maxItem.Value)}},{key:"GreaterThanOrEquals",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>=t.minItem.Value&&this.maxItem.Value>=t.maxItem.Value)}},{key:"LessThan",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<t.minItem.Value)}},{key:"LessThanOrEquals",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<=t.maxItem.Value&&this.minItem.Value<=t.minItem.Value)}},{key:"MaxAsList",value:function(){return this.Count>0?new t(this.maxItem):new t}},{key:"MinAsList",value:function(){return this.Count>0?new t(this.minItem):new t}},{key:"Equals",value:function(e){var n=e;if(n instanceof t==!1)return!1;if(n.Count!=this.Count)return!1;var i=!0;return this.forEach(function(t){n.ContainsKey(t.Key)||(i=!1)}),i}},{key:"toString",value:function(){var t=[];this.forEach(function(e){t.push(e)}),t=t.sort(function(t,e){return t.Value===e.Value?0:t.Value>e.Value?1:-1});for(var e=new c,n=0;n<t.length;n++){n>0&&e.Append(", ");var i=t[n].Key;e.Append(i.itemName)}return e.toString()}},{key:"valueOf",value:function(){return NaN}},{key:"Count",get:function(){return Object.keys(this._values).length}},{key:"originOfMaxItem",get:function(){if(null==this.origins)return null;var t=this.maxItem.Key.originName,e=null;return this.origins.every(function(n){return n.name!=t||(e=n,!1)}),e}},{key:"originNames",get:function(){var t=this;return this.Count>0&&(null==this._originNames&&this.Count>0?this._originNames=[]:this._originNames.length=0,this.forEach(function(e){t._originNames.push(e.Key.originName)})),this._originNames}},{key:"maxItem",get:function(){var t={Key:null,Value:null};return this.forEach(function(e){(null===t.Key||e.Value>t.Value)&&(t=e)}),t}},{key:"minItem",get:function(){var t={Key:null,Value:null};return this.forEach(function(e){(null===t.Key||e.Value<t.Value)&&(t=e)}),t}},{key:"inverse",get:function(){var e=this,n=new t;return null!=this.origins&&this.origins.forEach(function(t){t.items.forEach(function(t){e.ContainsKey(t.Key)||n.Add(t.Key,t.Value)})}),n}},{key:"all",get:function(){var e=new t;return null!=this.origins&&this.origins.forEach(function(t){t.items.forEach(function(t){e.Add(t.Key,t.Value)})}),e}}]),t}(),d={Int:0,Float:1,List:2,String:3,DivertTarget:4,VariablePointer:5},p=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._valueType,i._isTruthy,i._valueObject,i}return o(e,t),a(e,[{key:"Cast",value:function(t){throw"Trying to casting an AbstractValue"}},{key:"Copy",value:function(t){return e.Create(t)}},{key:"valueType",get:function(){return this._valueType}},{key:"isTruthy",get:function(){return this._isTruthy}},{key:"valueObject",get:function(){return this._valueObject}}],[{key:"Create",value:function(t){if("boolean"==typeof t){var e=!!t;t=e?1:0}return Number.isInteger(Number(t))?new m(t):isNaN(t)?"string"==typeof t?new k(t):t instanceof u?new C(t):t instanceof v?new b(t):null:new g(t)}}]),e}(h),y=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.value=t,i}return o(e,t),a(e,[{key:"toString",value:function(){return this.value.toString()}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}},{key:"valueObject",get:function(){return this.value}}]),e}(p),m=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||0));return i._valueType=d.Int,i}return o(e,t),a(e,[{key:"Cast",value:function(t){if(t==this.valueType)return this;if(t==d.Float)return new g(parseFloat(this.value));if(t==d.String)return new k(""+this.value);throw"Unexpected type cast of Value to new ValueType"}},{key:"isTruthy",get:function(){return 0!=this.value}},{key:"valueType",get:function(){return d.Int}}]),e}(y),g=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||0));return i._valueType=d.Float,i}return o(e,t),a(e,[{key:"Cast",value:function(t){if(t==this.valueType)return this;if(t==d.Int)return new m(parseInt(this.value));if(t==d.String)return new k(""+this.value);throw"Unexpected type cast of Value to new ValueType"}},{key:"isTruthy",get:function(){return 0!=this._value}},{key:"valueType",get:function(){return d.Float}}]),e}(y),k=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||""));return i._valueType=d.String,i._isNewline="\n"==i.value,i._isInlineWhitespace=!0,i.value.split().every(function(t){return" "==t||"\t"==t||(i._isInlineWhitespace=!1,!1)}),i}return o(e,t),a(e,[{key:"Cast",value:function(t){if(t==this.valueType)return this;if(t==d.Int){var e;return(e=parseInt(value))?new m(e):null}if(t==d.Float){var n;return(n=n(value))?new g(n):null}throw"Unexpected type cast of Value to new ValueType"}},{key:"valueType",get:function(){return d.String}},{key:"isTruthy",get:function(){return this.value.length>0}},{key:"isNewline",get:function(){return this._isNewline}},{key:"isInlineWhitespace",get:function(){return this._isInlineWhitespace}},{key:"isNonWhitespace",get:function(){return!this.isNewline&&!this.isInlineWhitespace}}]),e}(y),C=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._valueType=d.DivertTarget,i}return o(e,t),a(e,[{key:"Cast",value:function(t){if(t==this.valueType)return this;throw"Unexpected type cast of Value to new ValueType"}},{key:"toString",value:function(){return"DivertTargetValue("+this.targetPath+")"}},{key:"targetPath",get:function(){return this.value},set:function(t){this.value=t}},{key:"isTruthy",get:function(){throw"Shouldn't be checking the truthiness of a divert target"}}]),e}(y),S=function(t){function e(t,i){n(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a._valueType=d.VariablePointer,a.contextIndex="undefined"!=typeof i?i:-1,a}return o(e,t),a(e,[{key:"Cast",value:function(t){if(t==this.valueType)return this;throw"Unexpected type cast of Value to new ValueType"}},{key:"toString",value:function(){return"VariablePointerValue("+this.variableName+")"}},{key:"Copy",value:function(){return new e(this.variableName,this.contextIndex)}},{key:"variableName",get:function(){return this.value},set:function(t){this.value=t}},{key:"isTruthy",get:function(){throw"Shouldn't be checking the truthiness of a variable pointer"}}]),e}(y),b=function(t){function e(t,i){n(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,null));return a._valueType=d.List,t instanceof v?a.value=new v(t):void 0!==t&&void 0!==i?a.value=new v({Key:t,Value:i}):a.value=new v,a}return o(e,t),a(e,[{key:"Cast",value:function(t){if(t==d.Int){var e=this.value.maxItem;return new m(e.Key.isNull?0:e.Value)}if(t==d.Float){var e=this.value.maxItem;return new g(e.Key.isNull?0:parseFloat(e.Value))}if(t==d.String){var e=value.maxItem;return new k(e.Key.isNull?"":e.Key.toString())}if(t==this.valueType)return this;throw"Unexpected type cast of Value to new ValueType"}},{key:"valueType",get:function(){return d.List}},{key:"isTruthy",get:function(){var t=!1;return this.value.forEach(function(e){var n=e.Value;0!=n&&(t=!0)}),t}}]),a(e,null,[{key:"RetainListOriginsForAssignment",value:function(t,n){var i=t,a=n;i instanceof e&&a instanceof e&&0==a.value.Count&&a.value.SetInitialOriginNames(i.value.originNames)}}]),e}(y),T=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.message=t,i.name="StoryException",i}return o(e,t),e}(Error),_=function(t){function e(){n(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.name="",t._content=[],t.namedContent={},t.visitsShouldBeCounted=!1,t.turnIndexShouldBeCounted=!1,t.countingAtStartOnly=!1,t.CountFlags={Visits:1,Turns:2,CountStartOnly:4},t._pathToFirstLeafContent=null,t}return o(e,t),a(e,[{key:"AddContent",value:function(t){var e=this;if(t instanceof Array)t.forEach(function(t){e.AddContent(t)});else{if(this._content.push(t),t.parent)throw"content is already in "+t.parent;t.parent=this,this.TryAddNamedContent(t)}}},{key:"TryAddNamedContent",value:function(t){t.hasValidName&&t.name&&this.AddToNamedContentOnly(t)}},{key:"AddToNamedContentOnly",value:function(t){t instanceof h==!1&&console.warn("Can only add Runtime.Objects to a Runtime.Container"),t.parent=this,this.namedContent[t.name]=t}},{key:"ContentAtPath",value:function(t,n){n="undefined"!=typeof n?n:t.components.length;for(var i=this,a=this,r=0;r<n;++r){var o=t.components[r];if(!(i instanceof e))throw"Path continued, but previous object wasn't a container: "+a;a=i.ContentWithPathComponent(o),i=a}return a}},{key:"InsertContent",value:function(t,e){if(this.content[i]=t,t.parent)throw"content is already in "+t.parent;t.parent=this,this.TryAddNamedContent(t)}},{key:"AddContentsOfContainer",value:function(t){var e=this;this.content=this.content.concat(t.content),t.content.forEach(function(t){t.parent=e,e.TryAddNamedContent(t)})}},{key:"ContentWithPathComponent",value:function(t){if(t.isIndex)return t.index>=0&&t.index<this.content.length?this.content[t.index]:null;if(t.isParent)return this.parent;var e=null;if(e=this.namedContent[t.name])return e;throw new T("Content '"+t.name+"' not found at path: '"+this.path+"'")}},{key:"BuildStringOfHierarchy",value:function(t,n,i){function a(){for(var e=4,i=0;i<e*n;++i)t.Append(" ")}if(0==arguments.length){var t=new c;return this.BuildStringOfHierarchy(t,0,null),t.toString()}a(),t.Append("["),this.hasValidName&&t.AppendFormat(" ({0})",this.name),this==i&&t.Append("  <---"),t.AppendLine(),n++;for(var r=0;r<this.content.length;++r){var o=this.content[r];if(o instanceof e){var s=o;s.BuildStringOfHierarchy(t,n,i)}else a(),o instanceof k?(t.Append('"'),t.Append(o.toString().replace("\n","\\n")),t.Append('"')):t.Append(o.toString());r!=this.content.length-1&&t.Append(","),o instanceof e||o!=i||t.Append("  <---"),t.AppendLine()}var u={};for(var l in this.namedContent)this.content.indexOf(this.namedContent[l])>=0||(u[l]=this.namedContent[l]);if(Object.keys(u).length>0){a(),t.AppendLine("-- named: --");for(var l in u){u[l]instanceof e||console.warn("Can only print out named Containers");var s=u[l];s.BuildStringOfHierarchy(t,n,i),t.Append("\n")}}n--,a(),t.Append("]")}},{key:"hasValidName",get:function(){return null!=this.name&&this.name.length>0}},{key:"content",get:function(){return this._content},set:function(t){this.AddContent(t)}},{key:"namedOnlyContent",get:function(){var t={};for(var e in this.namedContent)t[e]=this.namedContent[e];return this.content.forEach(function(e){var n=e;n.name&&n.hasValidName&&delete t[n.name]}),0==Object.keys(t).length&&(t=null),t},set:function(t){var e=this.namedOnlyContent;if(null!=e)for(var n in e)delete this.namedContent[n];if(null!=t)for(var n in t){var i=t[n];i.name&&"undefined"!=typeof i.hasValidName&&this.AddToNamedContentOnly(i)}}},{key:"countFlags",get:function(){var t=0;return this.visitsShouldBeCounted&&(t|=this.CountFlags.Visits),this.turnIndexShouldBeCounted&&(t|=this.CountFlags.Turns),this.countingAtStartOnly&&(t|=this.CountFlags.CountStartOnly),t==this.CountFlags.CountStartOnly&&(t=0),t},set:function(t){var e=t;(e&this.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(e&this.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(e&this.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}},{key:"pathToFirstLeafContent",get:function(){return null==this._pathToFirstLeafContent&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}},{key:"internalPathToFirstLeafContent",get:function(){for(var t=new Path,n=this;n instanceof e;)n.content.length>0&&(t.components.push(new Path.Component(0)),n=n.content[0]);return t}}]),e}(h),O=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.glueType=t,i}return o(e,t),a(e,[{key:"toString",value:function(){switch(this.glueType){case E.Bidirectional:return"BidirGlue";case E.Left:return"LeftGlue";case E.Right:return"RightGlue"}return"UnexpectedGlueType"}},{key:"isLeft",get:function(){return this.glueType==E.Left}},{key:"isBi",get:function(){return this.glueType==E.Bidirectional}},{key:"isRight",get:function(){return this.glueType==E.Right}}]),e}(h),E={Bidirectional:0,Left:1,Right:2},w=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._commandType="undefined"!=typeof t?t:x.NotSet,i}return o(e,t),a(e,[{key:"copy",value:function(){return new e(this.commandType)}},{key:"toString",value:function(){return this.commandType.toString()}},{key:"commandType",get:function(){return this._commandType}}],[{key:"EvalStart",value:function(){return new e(x.EvalStart)}},{key:"EvalOutput",value:function(){return new e(x.EvalOutput)}},{key:"EvalEnd",value:function(){return new e(x.EvalEnd)}},{key:"Duplicate",value:function(){return new e(x.Duplicate)}},{key:"PopEvaluatedValue",value:function(){return new e(x.PopEvaluatedValue)}},{key:"PopFunction",value:function(){return new e(x.PopFunction)}},{key:"PopTunnel",value:function(){return new e(x.PopTunnel)}},{key:"BeginString",value:function(){return new e(x.BeginString)}},{key:"EndString",value:function(){return new e(x.EndString)}},{key:"NoOp",value:function(){return new e(x.NoOp)}},{key:"ChoiceCount",value:function(){return new e(x.ChoiceCount)}},{key:"TurnsSince",value:function(){return new e(x.TurnsSince)}},{key:"ReadCount",value:function(){return new e(x.ReadCount)}},{key:"Random",value:function(){return new e(x.Random)}},{key:"SeedRandom",value:function(){return new e(x.SeedRandom)}},{key:"VisitIndex",value:function(){return new e(x.VisitIndex)}},{key:"SequenceShuffleIndex",value:function(){return new e(x.SequenceShuffleIndex)}},{key:"StartThread",value:function(){return new e(x.StartThread)}},{key:"Done",value:function(){return new e(x.Done)}},{key:"End",value:function(){return new e(x.End)}},{key:"ListFromInt",value:function(){return new e(x.ListFromInt)}},{key:"ListRange",value:function(){return new e(x.ListRange)}}]),e}(h),x={NotSet:-1,EvalStart:0,EvalOutput:1,EvalEnd:2,Duplicate:3,PopEvaluatedValue:4,PopFunction:5,PopTunnel:6,BeginString:7,EndString:8,NoOp:9,ChoiceCount:10,TurnsSince:11,Random:12,SeedRandom:13,VisitIndex:14,SequenceShuffleIndex:15,StartThread:16,Done:17,End:18,ListFromInt:19,ListRange:20,ReadCount:21};x.TOTAL_VALUES=Object.keys(x).length-1,w.CommandType=x;var I={Tunnel:0,Function:1},P=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._targetPath,i._targetContent,i.variableDivertName,i.pushesToStack,i.stackPushType,i.isExternal,i.isConditional,i.externalArgs,i.pushesToStack=!1,t&&(i.pushesToStack=!0,i.stackPushType=t),i}return o(e,t),a(e,[{key:"Equals",value:function(t){var n=t;return n instanceof e&&this.hasVariableTarget==n.hasVariableTarget&&(this.hasVariableTarget?this.variableDivertName==n.variableDivertName:this.targetPath.Equals(n.targetPath))}},{key:"toString",value:function(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(null==this.targetPath)return"Divert(null)";var t=new c,e=this.targetPath.toString(),n=null;return null!=n&&(e="line "+n),t.Append("Divert"),this.pushesToStack&&(this.stackPushType==I.Function?t.Append(" function"):t.Append(" tunnel")),t.Append(" ("),t.Append(e),t.Append(")"),t.toString()}},{key:"targetPath",get:function(){if(null!=this._targetPath&&this._targetPath.isRelative){var t=this.targetContent;t&&(this._targetPath=t.path)}return this._targetPath},set:function(t){this._targetPath=t,this._targetContent=null}},{key:"targetContent",get:function(){return null==this._targetContent&&(this._targetContent=this.ResolvePath(this._targetPath)),this._targetContent}},{key:"targetPathString",get:function(){return null==this.targetPath?null:this.CompactPathString(this.targetPath)},set:function(t){null==t?this.targetPath=null:this.targetPath=new u(t)}},{key:"hasVariableTarget",get:function(){return null!=this.variableDivertName}}]),e}(h),A=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._pathOnChoice,i.hasCondition,i.hasStartContent,i.hasChoiceOnlyContent,i.onceOnly,i.isInvisibleDefault,i.onceOnly=!!t,i}return o(e,t),a(e,[{key:"toString",value:function(){var t=null,e=this.pathOnChoice.toString();return null!=t&&(e=" line "+t),"Choice: -> "+e}},{key:"pathOnChoice",get:function(){if(null!=this._pathOnChoice&&this._pathOnChoice.isRelative){var t=this.choiceTarget;t&&(this._pathOnChoice=t.path)}return this._pathOnChoice},set:function(t){this._pathOnChoice=t}},{key:"choiceTarget",get:function(){return this.ResolvePath(this._pathOnChoice)}},{key:"pathStringOnChoice",get:function(){return this.CompactPathString(this.pathOnChoice)},set:function(t){this.pathOnChoice=new u(t)}},{key:"flags",get:function(){var t=0;return this.hasCondition&&(t|=1),this.hasStartContent&&(t|=2),this.hasChoiceOnlyContent&&(t|=4),this.isInvisibleDefault&&(t|=8),this.onceOnly&&(t|=16),t},set:function(t){this.hasCondition=(1&t)>0,this.hasStartContent=(2&t)>0,this.hasChoiceOnlyContent=(4&t)>0,this.isInvisibleDefault=(8&t)>0,this.onceOnly=(16&t)>0}}]),e}(h),N=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.name=t,i.pathForCount,i}return o(e,t),a(e,[{key:"toString",value:function(){if(null!=this.name)return"var("+this.name+")";var t=this.pathStringForCount;return"read_count("+t+")"}},{key:"containerForCount",get:function(){return this.ResolvePath(this.pathForCount)}},{key:"pathStringForCount",get:function(){return null==this.pathForCount?null:this.CompactPathString(this.pathForCount)},set:function(t){null==t?this.pathForCount=null:this.pathForCount=new u(t)}}]),e}(h),V=function(t){function e(t,i){n(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._variableName=t||null,a._isNewDeclaration=!!i,a.isGlobal,a}return o(e,t),a(e,[{key:"toString",value:function(){return"VarAssign to "+this.variableName}},{key:"variableName",get:function(){return this._variableName}},{key:"isNewDeclaration",get:function(){return this._isNewDeclaration}}]),e}(h),F=function(t){function e(){return n(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(h),L=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.name=t,i._numberOfParameters,i._prototype,i._isPrototype,i._operationFuncs=null,e.GenerateNativeFunctionsIfNecessary(),i}return o(e,t),a(e,[{key:"Call",value:function(t){if(this._prototype)return this._prototype.Call(t);if(this.numberOfParameters!=t.length)throw"Unexpected number of parameters";var e=!1;if(t.forEach(function(t){if(t instanceof F)throw new T("Attempting to perform operation on a void value. Did you forget to 'return' a value from a function you called here?");t instanceof b&&(e=!0)}),2==t.length&&e)return this.CallBinaryListOperation(t);var n=this.CoerceValuesToSingleType(t),i=n[0].valueType;return i==d.Int?this.CallType(n):i==d.Float?this.CallType(n):i==d.String?this.CallType(n):i==d.DivertTarget?this.CallType(n):i==d.List?this.CallType(n):null}},{key:"CallType",value:function(t){var e=t[0],n=e.valueType,i=e,a=t.length;if(2==a||1==a){var r=this._operationFuncs[n];if(!r)throw new T("Cannot perform operation '"+this.name+"' on "+n);if(2==a){var o=t[1],s=o,u=r,l=u(i.value,s.value);return y.Create(l)}var u=r,l=u(i.value);return y.Create(l)}throw"Unexpected number of parameters to NativeFunctionCall: "+t.length}},{key:"CallBinaryListOperation",value:function(t){if(("+"==this.name||"-"==this.name)&&t[0]instanceof b&&t[1]instanceof m)return this.CallListIncrementOperation(t);var e=t[0],n=t[1];if(!("&&"!=this.name&&"||"!=this.name||e.valueType==d.List&&n.valueType==d.List)){var i=this._operationFuncs[d.Int],a=i(e.isTruthy?1:0,n.isTruthy?1:0);return new m(a)}if(e.valueType==d.List&&n.valueType==d.List)return this.CallType([e,n]);throw new T("Can not call use '"+this.name+"' operation on "+e.valueType+" and "+n.valueType)}},{key:"CallListIncrementOperation",value:function(t){var e=this,n=t[0],i=t[1],a=new v;return n.value.forEach(function(t){var r=t.Key,o=t.Value,s=e._operationFuncs[d.Int],u=s(o,i.value),l=null;if(n.value.origins.forEach(function(t){if(t.name==r.originName)return l=t,!1}),null!=l){var h=l.TryGetItemWithValue(u);h.exists&&a.Add(h.item,u)}}),new b(a)}},{key:"CoerceValuesToSingleType",value:function(t){var e=d.Int,n=null;t.forEach(function(t){var i=t;i.valueType>e&&(e=i.valueType),i.valueType==d.List&&(n=i)});var i=[];return e==d.List?t.forEach(function(t){if(t.valueType==d.List)i.push(t);else{if(t.valueType!=d.Int)throw new T("Cannot mix Lists and "+t.valueType+" values in this operation");var e=parseInt(t.valueObject),a=n.value.originOfMaxItem,r=a.TryGetItemWithValue(e);if(!r.exists)throw new T("Could not find List item with the value "+e+" in "+a.name);var o=new b(r.item,e);i.push(o)}}):t.forEach(function(t){var n=t.Cast(e);i.push(n)}),i}},{key:"AddOpFuncForType",value:function(t,e){null==this._operationFuncs&&(this._operationFuncs={}),this._operationFuncs[t]=e}},{key:"toString",value:function(){return"Native '"+this.name+"'"}},{key:"name",get:function(){return this._name},set:function(t){this._name=t,this._isPrototype||(this._prototype=e._nativeFunctions[this._name])}},{key:"numberOfParameters",get:function(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters},set:function(t){this._numberOfParameters=t}}],[{key:"internalConstructor",value:function(t,n){var i=new e(t);return i._isPrototype=!0,i.numberOfParameters=n,i}},{key:"CallWithName",value:function(t){return new e(t)}},{key:"CallExistsWithName",value:function(t){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions[t]}},{key:"GenerateNativeFunctionsIfNecessary",value:function(){if(null==this._nativeFunctions){this._nativeFunctions={},this.AddIntBinaryOp(this.Add,function(t,e){return t+e}),this.AddIntBinaryOp(this.Subtract,function(t,e){
        return t-e}),this.AddIntBinaryOp(this.Multiply,function(t,e){return t*e}),this.AddIntBinaryOp(this.Divide,function(t,e){return parseInt(t/e)}),this.AddIntBinaryOp(this.Mod,function(t,e){return t%e}),this.AddIntUnaryOp(this.Negate,function(t){return-t}),this.AddIntBinaryOp(this.Equal,function(t,e){return t==e?1:0}),this.AddIntBinaryOp(this.Greater,function(t,e){return t>e?1:0}),this.AddIntBinaryOp(this.Less,function(t,e){return t<e?1:0}),this.AddIntBinaryOp(this.GreaterThanOrEquals,function(t,e){return t>=e?1:0}),this.AddIntBinaryOp(this.LessThanOrEquals,function(t,e){return t<=e?1:0}),this.AddIntBinaryOp(this.NotEquals,function(t,e){return t!=e?1:0}),this.AddIntUnaryOp(this.Not,function(t){return 0==t?1:0}),this.AddIntBinaryOp(this.And,function(t,e){return 0!=t&&0!=e?1:0}),this.AddIntBinaryOp(this.Or,function(t,e){return 0!=t||0!=e?1:0}),this.AddIntBinaryOp(this.Max,function(t,e){return Math.max(t,e)}),this.AddIntBinaryOp(this.Min,function(t,e){return Math.min(t,e)}),this.AddFloatBinaryOp(this.Add,function(t,e){return t+e}),this.AddFloatBinaryOp(this.Subtract,function(t,e){return t-e}),this.AddFloatBinaryOp(this.Multiply,function(t,e){return t*e}),this.AddFloatBinaryOp(this.Divide,function(t,e){return t/e}),this.AddFloatBinaryOp(this.Mod,function(t,e){return t%e}),this.AddFloatUnaryOp(this.Negate,function(t){return-t}),this.AddFloatBinaryOp(this.Equal,function(t,e){return t==e?1:0}),this.AddFloatBinaryOp(this.Greater,function(t,e){return t>e?1:0}),this.AddFloatBinaryOp(this.Less,function(t,e){return t<e?1:0}),this.AddFloatBinaryOp(this.GreaterThanOrEquals,function(t,e){return t>=e?1:0}),this.AddFloatBinaryOp(this.LessThanOrEquals,function(t,e){return t<=e?1:0}),this.AddFloatBinaryOp(this.NotEquals,function(t,e){return t!=e?1:0}),this.AddFloatUnaryOp(this.Not,function(t){return 0==t?1:0}),this.AddFloatBinaryOp(this.And,function(t,e){return 0!=t&&0!=e?1:0}),this.AddFloatBinaryOp(this.Or,function(t,e){return 0!=t||0!=e?1:0}),this.AddFloatBinaryOp(this.Max,function(t,e){return Math.max(t,e)}),this.AddFloatBinaryOp(this.Min,function(t,e){return Math.min(t,e)}),this.AddStringBinaryOp(this.Add,function(t,e){return t+e}),this.AddStringBinaryOp(this.Equal,function(t,e){return t===e?1:0}),this.AddStringBinaryOp(this.NotEquals,function(t,e){return t!==e?1:0}),this.AddListBinaryOp(this.Add,function(t,e){return t.Union(e)}),this.AddListBinaryOp(this.Subtract,function(t,e){return t.Without(e)}),this.AddListBinaryOp(this.Has,function(t,e){return t.Contains(e)?1:0}),this.AddListBinaryOp(this.Hasnt,function(t,e){return t.Contains(e)?0:1}),this.AddListBinaryOp(this.Intersect,function(t,e){return t.Intersect(e)}),this.AddListBinaryOp(this.Equal,function(t,e){return t.Equals(e)?1:0}),this.AddListBinaryOp(this.Greater,function(t,e){return t.GreaterThan(e)?1:0}),this.AddListBinaryOp(this.Less,function(t,e){return t.LessThan(e)?1:0}),this.AddListBinaryOp(this.GreaterThanOrEquals,function(t,e){return t.GreaterThanOrEquals(e)?1:0}),this.AddListBinaryOp(this.LessThanOrEquals,function(t,e){return t.LessThanOrEquals(e)?1:0}),this.AddListBinaryOp(this.NotEquals,function(t,e){return t.Equals(e)?0:1}),this.AddListBinaryOp(this.And,function(t,e){return t.Count>0&&e.Count>0?1:0}),this.AddListBinaryOp(this.Or,function(t,e){return t.Count>0||e.Count>0?1:0}),this.AddListUnaryOp(this.Not,function(t){return 0==t.Count?1:0}),this.AddListUnaryOp(this.Invert,function(t){return t.inverse}),this.AddListUnaryOp(this.All,function(t){return t.all}),this.AddListUnaryOp(this.ListMin,function(t){return t.MinAsList()}),this.AddListUnaryOp(this.ListMax,function(t){return t.MaxAsList()}),this.AddListUnaryOp(this.Count,function(t){return t.Count}),this.AddListUnaryOp(this.ValueOfList,function(t){return t.maxItem.Value});var t=function(t,e){return t.Equals(e)?1:0};this.AddOpToNativeFunc(this.Equal,2,d.DivertTarget,t)}}},{key:"AddOpToNativeFunc",value:function(t,n,i,a){var r=this._nativeFunctions[t];r||(r=e.internalConstructor(t,n),this._nativeFunctions[t]=r),r.AddOpFuncForType(i,a)}},{key:"AddIntBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,d.Int,e)}},{key:"AddIntUnaryOp",value:function(t,e){this.AddOpToNativeFunc(t,1,d.Int,e)}},{key:"AddFloatBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,d.Float,e)}},{key:"AddFloatUnaryOp",value:function(t,e){this.AddOpToNativeFunc(t,1,d.Float,e)}},{key:"AddStringBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,d.String,e)}},{key:"AddListBinaryOp",value:function(t,e){this.AddOpToNativeFunc(t,2,d.List,e)}},{key:"AddListUnaryOp",value:function(t,e){this.AddOpToNativeFunc(t,1,d.List,e)}}]),e}(h);L.Add="+",L.Subtract="-",L.Divide="/",L.Multiply="*",L.Mod="%",L.Negate="_",L.Equal="==",L.Greater=">",L.Less="<",L.GreaterThanOrEquals=">=",L.LessThanOrEquals="<=",L.NotEquals="!=",L.Not="!",L.And="&&",L.Or="||",L.Min="MIN",L.Max="MAX",L.Has="?",L.Hasnt="!?",L.Intersect="^",L.ListMin="LIST_MIN",L.ListMax="LIST_MAX",L.All="LIST_ALL",L.Count="LIST_COUNT",L.ValueOfList="LIST_VALUE",L.Invert="LIST_INVERT",L._nativeFunctions=null;var j=function(t){function e(t){n(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._text=t.toString()||"",i}return o(e,t),a(e,[{key:"toString",value:function(){return"# "+this._text}},{key:"text",get:function(){return this._text}}]),e}(h),R=function(){function t(e){n(this,t),this.text,this.index,this.choicePoint,this.threadAtGeneration,this._originalThreadIndex,this._originalChoicePath,e&&(this.choicePoint=e)}return a(t,[{key:"pathStringOnChoice",get:function(){return this.choicePoint.pathStringOnChoice}},{key:"sourcePath",get:function(){return this.choicePoint.path.componentsString}}]),t}(),D=function(){function t(e,i){n(this,t),this._name=e||"",this._items=null,this._rawListItemsKeys=null,this._itemNameToValues=i||{}}return a(t,[{key:"forEachItems",value:function(t){for(var e in this._rawListItemsKeys)t({Key:this._rawListItemsKeys[e],Value:this._items[e]})}},{key:"ValueForItem",value:function(t){var e=this._itemNameToValues[t.itemName];return void 0!==e?e:0}},{key:"ContainsItem",value:function(t){return t.originName==this.name&&t.itemName in this._itemNameToValues}},{key:"ContainsItemWithName",value:function(t){return void 0!==this._itemNameToValues[t]}},{key:"TryGetItemWithValue",value:function(t,e){for(var n in this._itemNameToValues)if(this._itemNameToValues[n]==t)return e=new f(this.name,n),{item:e,exists:!0};return e=f.Null,{item:e,exists:!1}}},{key:"TryGetValueForItem",value:function(t,e){return intVal=this._itemNameToValues[t.itemName],intVal}},{key:"ListRange",value:function(t,e){var n=new v;for(var i in this._itemNameToValues)if(this._itemNameToValues[i]>=t&&this._itemNameToValues[i]<=e){var a=new f(this.name,i);n.Add(a,this._itemNameToValues[i])}return new b(n)}},{key:"name",get:function(){return this._name}},{key:"items",get:function(){if(null==this._items){this._items={},this._rawListItemsKeys={};for(var t in this._itemNameToValues){var e=new f(this.name,t);this._rawListItemsKeys[e]=e,this._items[e]=this._itemNameToValues[t]}}return this._items.forEach=this.forEachItems.bind(this),this._items}}]),t}(),B=function(){function t(e){var i=this;n(this,t),this._lists={},e.forEach(function(t){i._lists[t.name]=t})}return a(t,[{key:"TryGetDefinition",value:function(t,e){return t in this._lists?this._lists[t]:e}},{key:"FindSingleItemListWithName",value:function(t){var e=f.Null,n=null,i=t.split(".");if(2==i.length)e=new f(i[0],i[1]),n=this.TryGetDefinition(e.originName,n);else for(var a in this._lists){var r=this._lists[a];if(e=new f(a,t),r.ContainsItem(e)){n=r;break}}if(null!=n){var o=n.ValueForItem(e);return new b(e,o)}return null}},{key:"lists",get:function(){var t=[];for(var e in this._lists)t.push(this._lists[e]);return t}}]),t}(),G=function(){function t(){n(this,t)}return a(t,null,[{key:"ListToJArray",value:function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.RuntimeObjectToJToken(t))}),n}},{key:"JArrayToRuntimeObjList",value:function(t,e){var n=t.length;e&&n--;for(var i=[],a=0;a<n;a++){var r=t[a],o=this.JTokenToRuntimeObject(r);i.push(o)}return i}},{key:"JObjectToDictionaryRuntimeObjs",value:function(t){var e={};for(var n in t)e[n]=this.JTokenToRuntimeObject(t[n]);return e}},{key:"DictionaryRuntimeObjsToJObject",value:function(t){var e={};for(var n in t){var i=t[n];i instanceof h&&(e[n]=this.RuntimeObjectToJToken(i))}return e}},{key:"JObjectToIntDictionary",value:function(t){var e={};for(var n in t)e[n]=parseInt(t[n]);return e}},{key:"IntDictionaryToJObject",value:function(t){var e={};for(var n in t)e[n]=t[n];return e}},{key:"JTokenToRuntimeObject",value:function(t){if(!isNaN(t)&&"\n"!==t)return y.Create(t);if("string"==typeof t){var n=t.toString(),i=n[0];if("^"==i)return new k(n.substring(1));if("\n"==i&&1==n.length)return new k("\n");if("<>"==n)return new O(E.Bidirectional);if("G<"==n)return new O(E.Left);if("G>"==n)return new O(E.Right);for(var a=0;a<J.length;++a){var r=J[a];if(n==r)return new w(a)}if("L^"==n&&(n="^"),L.CallExistsWithName(n))return L.CallWithName(n);if("->->"==n)return w.PopTunnel();if("~ret"==n)return w.PopFunction();if("void"==n)return new F}if("object"===("undefined"==typeof t?"undefined":e(t))&&t instanceof Array==!1){var o,s=t;if(s["^->"])return o=s["^->"],new C(new u(o.toString()));if(s["^var"]){o=s["^var"];var l=new S(o.toString());return s.ci&&(o=s.ci,l.contextIndex=parseInt(o)),l}var h=!1,c=!1,d=I.Function,p=!1;if((o=s["->"])?h=!0:(o=s["f()"])?(h=!0,c=!0,d=I.Function):(o=s["->t->"])?(h=!0,c=!0,d=I.Tunnel):(o=s["x()"])&&(h=!0,p=!0,c=!1,d=I.Function),h){var m=new P;m.pushesToStack=c,m.stackPushType=d,m.isExternal=p;var g=o.toString();return(o=s.var)?m.variableDivertName=g:m.targetPathString=g,m.isConditional=!!s.c,p&&(o=s.exArgs)&&(m.externalArgs=parseInt(o)),m}if(o=s["*"]){var T=new A;return T.pathStringOnChoice=o.toString(),(o=s.flg)&&(T.flags=parseInt(o)),T}if(o=s["VAR?"])return new N(o.toString());if(o=s["CNT?"]){var _=new N;return _.pathStringForCount=o.toString(),_}var x=!1,R=!1;if((o=s["VAR="])?(x=!0,R=!0):(o=s["temp="])&&(x=!0,R=!1),x){var D=o.toString(),B=!s.re,G=new V(D,B);return G.isGlobal=R,G}if(void 0!==s["#"])return o=s["#"],new j(o.toString());if(o=s.list){var M=o,W=new v;if(o=s.origins){var q=o;W.SetInitialOriginNames(q)}for(var K in M){var U=M[K],H=new f(K),X=parseInt(U);W.Add(H,X)}return new b(W)}if(null!=s.originalChoicePath)return this.JObjectToChoice(s)}if(t instanceof Array)return this.JArrayToContainer(t);if(null==t)return null;throw"Failed to convert token to runtime object: "+JSON.stringify(t)}},{key:"RuntimeObjectToJToken",value:function(t){var e=t;if(e instanceof _)return this.ContainerToJArray(e);var n=t;if(n instanceof P){var i="->";n.isExternal?i="x()":n.pushesToStack&&(n.stackPushType==I.Function?i="f()":n.stackPushType==I.Tunnel&&(i="->t->"));var a;a=n.hasVariableTarget?n.variableDivertName:n.targetPathString;var r={};return r[i]=a,n.hasVariableTarget&&(r.var=!0),n.isConditional&&(r.c=!0),n.externalArgs>0&&(r.exArgs=n.externalArgs),r}var o=t;if(o instanceof A){var r={};return r["*"]=o.pathStringOnChoice,r.flg=o.flags,r}var s=t;if(s instanceof m)return s.value;var u=t;if(u instanceof g)return u.value;var l=t;if(l instanceof k)return l.isNewline?"\n":"^"+l.value;var h=t;if(h instanceof b)return this.InkListToJObject(h);var c=t;if(c instanceof C)return{"^->":c.value.componentsString};var f=t;if(f instanceof S)return{"^var":f.value,ci:f.contextIndex};var v=t;if(v instanceof O)return v.isBi?"<>":v.isLeft?"G<":"G>";var d=t;if(d instanceof w)return J[parseInt(d.commandType)];var p=t;if(p instanceof L){var y=p.name;return"^"==y&&(y="L^"),y}var T=t;if(T instanceof N){var r={},E=T.pathStringForCount;return null!=E?r["CNT?"]=E:r["VAR?"]=T.name,r}var x=t;if(x instanceof V){var D=x.isGlobal?"VAR=":"temp=",r={};return r[D]=x.variableName,x.isNewDeclaration||(r.re=!0),r}var B=t;if(B instanceof F)return"void";var G=t;if(G instanceof j){var r={};return r["#"]=G.text,r}var M=t;if(M instanceof R)return this.ChoiceToJObject(M);throw"Failed to convert runtime object to Json token: "+t}},{key:"ContainerToJArray",value:function(t){var e=this.ListToJArray(t.content),n=t.namedOnlyContent,i=t.countFlags;if(null!=n&&n.length>0||i>0||null!=t.name){var a;if(null!=n){a=this.DictionaryRuntimeObjsToJObject(n);for(var r in a){var o=a[r];if(null!=o){var s=o[o.length-1];null!=s&&(delete s["#n"],0==Object.keys(s).length&&(o[o.length-1]=null))}}}else a={};i>0&&(a["#f"]=i),null!=t.name&&(a["#n"]=t.name),e.push(a)}else e.push(null);return e}},{key:"JArrayToContainer",value:function(t){var e=new _;e.content=this.JArrayToRuntimeObjList(t,!0);var n=t[t.length-1];if(null!=n){var i={};for(var a in n)if("#f"==a)e.countFlags=parseInt(n[a]);else if("#n"==a)e.name=n[a].toString();else{var r=this.JTokenToRuntimeObject(n[a]),o=r;o instanceof _&&(o.name=a),i[a]=r}e.namedOnlyContent=i}return e}},{key:"JObjectToChoice",value:function(t){var e=new R;return e.text=t.text.toString(),e.index=parseInt(t.index),e.originalChoicePath=t.originalChoicePath.toString(),e.originalThreadIndex=parseInt(t.originalThreadIndex),e}},{key:"ChoiceToJObject",value:function(t){var e={};return e.text=t.text,e.index=t.index,e.originalChoicePath=t.originalChoicePath,e.originalThreadIndex=t.originalThreadIndex,e}},{key:"InkListToJObject",value:function(t){var e=t.value,n={},i={};return e.forEach(function(t){var e=t.Key,n=t.Value;i[e.toString()]=n}),n.list=i,0==e.Count&&null!=e.originNames&&e.originNames.length>0&&(n.origins=e.originNames),n}},{key:"ListDefinitionsToJToken",value:function(t){var e={};return t.lists.forEach(function(t){var n={};t.items.forEach(function(t){var e=t.Key,i=t.Value;n[e.itemName]=i}),e[t.name]=n}),e}},{key:"JTokenToListDefinitions",value:function(t){var e=t,n=[];for(var i in e){var a=i.toString(),r=e[i],o={};for(var s in r){var u=r[s];o[s]=parseInt(u)}var l=new D(a,o);n.push(l)}return new B(n)}}]),t}(),J=[];J[w.CommandType.EvalStart]="ev",J[w.CommandType.EvalOutput]="out",J[w.CommandType.EvalEnd]="/ev",J[w.CommandType.Duplicate]="du",J[w.CommandType.PopEvaluatedValue]="pop",J[w.CommandType.PopFunction]="~ret",J[w.CommandType.PopTunnel]="->->",J[w.CommandType.BeginString]="str",J[w.CommandType.EndString]="/str",J[w.CommandType.NoOp]="nop",J[w.CommandType.ChoiceCount]="choiceCnt",J[w.CommandType.TurnsSince]="turns",J[w.CommandType.ReadCount]="readc",J[w.CommandType.Random]="rnd",J[w.CommandType.SeedRandom]="srnd",J[w.CommandType.VisitIndex]="visit",J[w.CommandType.SequenceShuffleIndex]="seq",J[w.CommandType.StartThread]="thread",J[w.CommandType.Done]="done",J[w.CommandType.End]="end",J[w.CommandType.ListFromInt]="listInt",J[w.CommandType.ListRange]="range";for(var M=0;M<w.CommandType.TOTAL_VALUES;++M)if(null==J[M])throw"Control command not accounted for in serialisation";var W=function(){function t(e,i,a,r){n(this,t),this.currentContainer=i,this.currentContentIndex=a,this.inExpressionEvaluation=r||!1,this.temporaryVariables={},this.type=e}return a(t,[{key:"Copy",value:function(){var e=new t(this.type,this.currentContainer,this.currentContentIndex,this.inExpressionEvaluation);return r(e.temporaryVariables,this.temporaryVariables),e}},{key:"currentObject",get:function(){return this.currentContainer&&this.currentContentIndex<this.currentContainer.content.length?this.currentContainer.content[this.currentContentIndex]:null},set:function(t){var e=t;return null==e?(this.currentContainer=null,void(this.currentContentIndex=0)):(this.currentContainer=e.parent,this.currentContainer instanceof _&&(this.currentContentIndex=this.currentContainer.content.indexOf(e)),void(this.currentContainer instanceof _!=!1&&this.currentContentIndex!=-1||(this.currentContainer=e,this.currentContentIndex=0)))}}]),t}(),q=function(){function t(e,i){var a=this;if(n(this,t),this.callstack=[],this.threadIndex=0,this.previousContentObject=null,e&&i){var r=e;this.threadIndex=parseInt(r.threadIndex);var o=r.callstack;o.forEach(function(t){var e=t,n=parseInt(e.type),r=null,o=0,s=null,l=e.cPath;"undefined"!=typeof l&&(s=l.toString(),r=i.ContentAtPath(new u(s)),o=parseInt(e.idx));var h=!!e.exp,c=new W(n,r,o,h),f=e.temp;c.temporaryVariables=G.JObjectToDictionaryRuntimeObjs(f),a.callstack.push(c)});var s=r.previousContentObject;if("undefined"!=typeof s){var l=new u(s.toString());this.previousContentObject=i.ContentAtPath(l)}}}return a(t,[{key:"Copy",value:function(){var e=new t;return e.threadIndex=this.threadIndex,this.callstack.forEach(function(t){e.callstack.push(t.Copy())}),e.previousContentObject=this.previousContentObject,e}},{key:"jsonToken",get:function(){var t={},e=[];return this.callstack.forEach(function(t){var n={};t.currentContainer&&(n.cPath=t.currentContainer.path.componentsString,n.idx=t.currentContentIndex),n.exp=t.inExpressionEvaluation,n.type=parseInt(t.type),n.temp=G.DictionaryRuntimeObjsToJObject(t.temporaryVariables),e.push(n)}),t.callstack=e,t.threadIndex=this.threadIndex,null!=this.previousContentObject&&(t.previousContentObject=this.previousContentObject.path.toString()),t}}]),t}(),K=function(){function t(e){var i=this;n(this,t),this._threads=[],this._threadCounter=0,this._threads.push(new q),e instanceof t?(this._threads=[],e._threads.forEach(function(t){i._threads.push(t.Copy())})):this._threads[0].callstack.push(new W(I.Tunnel,e,0))}return a(t,[{key:"CanPop",value:function(t){return!!this.canPop&&(null==t||this.currentElement.type==t)}},{key:"Pop",value:function(t){if(this.CanPop(t))return void this.callStack.pop();throw"Mismatched push/pop in Callstack"}},{key:"Push",value:function(t){this.callStack.push(new W(t,this.currentElement.currentContainer,this.currentElement.currentContentIndex,!1))}},{key:"PushThread",value:function(){var t=this.currentThread.Copy();this._threadCounter++,t.threadIndex=this._threadCounter,this._threads.push(t)}},{key:"PopThread",value:function(){if(!this.canPopThread)throw"Can't pop thread";this._threads.splice(this._threads.indexOf(this.currentThread),1)}},{key:"SetJsonToken",value:function(t,e){var n=this;this._threads.length=0;var i=t,a=i.threads;a.forEach(function(t){var i=new q(t,e);n._threads.push(i)}),this._threadCounter=parseInt(i.threadCounter)}},{key:"GetJsonToken",value:function(){var t={},e=[];return this._threads.forEach(function(t){e.push(t.jsonToken)}),t.threads=e,t.threadCounter=this._threadCounter,t}},{key:"GetTemporaryVariableWithName",value:function(t,e){e="undefined"==typeof e?-1:e,e==-1&&(e=this.currentElementIndex+1);var n=null,i=this.callStack[e-1];return(n=i.temporaryVariables[t])?n:null}},{key:"SetTemporaryVariable",value:function(t,e,n,i){i="undefined"==typeof i?-1:i,i==-1&&(i=this.currentElementIndex+1);var a=this.callStack[i-1];if(!n&&!a.temporaryVariables[t])throw new T("Could not find temporary variable to set: "+t);var r;(r=a.temporaryVariables[t])&&b.RetainListOriginsForAssignment(r,e),a.temporaryVariables[t]=e}},{key:"ContextForVariableNamed",value:function(t){return this.currentElement.temporaryVariables[t]?this.currentElementIndex+1:0}},{key:"ThreadWithIndex",value:function(t){var e=this._threads.filter(function(e){if(e.threadIndex==t)return e});return e[0]}},{key:"currentThread",get:function(){return this._threads[this._threads.length-1]},set:function(t){1!=this._threads.length&&console.warn("Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(t)}},{key:"callStack",get:function(){return this.currentThread.callstack}},{key:"elements",get:function(){return this.callStack}},{key:"depth",get:function(){return this.elements.length}},{key:"currentElement",get:function(){return this.callStack[this.callStack.length-1]}},{key:"currentElementIndex",get:function(){return this.callStack.length-1}},{key:"canPop",get:function(){return this.callStack.length>1}},{key:"canPopThread",get:function(){return this._threads.length>1}}]),t}(),U=function(){function t(e,i){n(this,t),this._globalVariables={},this._callStack=e,this._listDefsOrigin=i,this._batchObservingVariableChanges=null,this._changedVariables=null,this.variableChangedEvent=null,this.variableChangedEventCallbacks=[];try{var a=new Proxy(this,{get:function(t,e){return e in t?t[e]:t.$(e)},set:function(t,e,n){return e in t?t[e]=n:t.$(e,n),!0}});return a}catch(t){}}return a(t,[{key:"ObserveVariableChange",value:function(t){var e=this;null==this.variableChangedEvent&&(this.variableChangedEvent=function(t,n){e.variableChangedEventCallbacks.forEach(function(e){e(t,n)})}),this.variableChangedEventCallbacks.push(t)}},{key:"CopyFrom",value:function(t){this._globalVariables=r({},t._globalVariables),this.variableChangedEvent=t.variableChangedEvent,t.batchObservingVariableChanges!=this.batchObservingVariableChanges&&(t.batchObservingVariableChanges?(this._batchObservingVariableChanges=!0,this._changedVariables=t._changedVariables):(this._batchObservingVariableChanges=!1,this._changedVariables=null))}},{key:"GetVariableWithName",value:function(t,e){"undefined"==typeof e&&(e=-1);var n=this.GetRawVariableWithName(t,e),i=n;return i instanceof S&&(n=this.ValueAtVariablePointer(i)),n}},{key:"GetRawVariableWithName",value:function(t,e){var n=null;if(0==e||e==-1){if(n=this._globalVariables[t])return n;var i=this._listDefsOrigin.FindSingleItemListWithName(t);if(i)return i}if(n=this._callStack.GetTemporaryVariableWithName(t,e),null==n)throw"RUNTIME ERROR: Variable '"+t+"' could not be found in context '"+e+"'. This shouldn't be possible so is a bug in the ink engine. Please try to construct a minimal story that reproduces the problem and report to inkle, thank you!";return n}},{key:"ValueAtVariablePointer",value:function(t){return this.GetVariableWithName(t.variableName,t.contextIndex)}},{key:"Assign",value:function(t,e){var n=t.variableName,i=-1,a=!1;if(a=t.isNewDeclaration?t.isGlobal:!!this._globalVariables[n],t.isNewDeclaration){var r=e;if(r instanceof S){var o=this.ResolveVariablePointer(r);e=o}}else{var s=null;do s=this.GetRawVariableWithName(n,i),s instanceof S&&(n=s.variableName,i=s.contextIndex,a=0==i);while(s instanceof S)}a?this.SetGlobal(n,e):this._callStack.SetTemporaryVariable(n,e,t.isNewDeclaration,i)}},{key:"RetainListOriginsForAssignment",value:function(t,e){var n=t,i=e;n instanceof b&&i instanceof b&&0==i.value.Count&&i.value.SetInitialOriginNames(n.value.originNames)}},{key:"SetGlobal",value:function(t,e){var n=null;n=this._globalVariables[t],b.RetainListOriginsForAssignment(n,e),this._globalVariables[t]=e,null!=this.variableChangedEvent&&e!==n&&(this.batchObservingVariableChanges?this._changedVariables.push(t):this.variableChangedEvent(t,e))}},{key:"ResolveVariablePointer",value:function(t){var e=t.contextIndex;e==-1&&(e=this.GetContextIndexOfVariableNamed(t.variableName));var n=this.GetRawVariableWithName(t.variableName,e),i=n;return i instanceof S?i:new S(t.variableName,e)}},{key:"GetContextIndexOfVariableNamed",value:function(t){return this._globalVariables[t]?0:this._callStack.currentElementIndex}},{key:"$",value:function(t,e){if("undefined"==typeof e){var n=this._globalVariables[t];return"undefined"!=typeof n?n.valueObject:null}if("undefined"==typeof this._globalVariables[t])throw new T("Variable '"+t+"' doesn't exist, so can't be set.");var i=y.Create(e);if(null==i)throw new T(null==e?"Cannot pass null to VariableState":"Invalid value passed to VariableState: "+e.toString());this.SetGlobal(t,i)}},{key:"callStack",get:function(){return this._callStack},set:function(t){this._callStack=t}},{key:"batchObservingVariableChanges",get:function(){return this._batchObservingVariableChanges},set:function(t){var e=this;t=!!t,this._batchObservingVariableChanges=t,t?this._changedVariables=[]:(null!=this._changedVariables&&this._changedVariables.forEach(function(t){var n=e._globalVariables[t];e.variableChangedEvent(t,n)}),this._changedVariables=null)}},{key:"jsonToken",get:function(){return G.DictionaryRuntimeObjsToJObject(this._globalVariables)},set:function(t){this._globalVariables=G.JObjectToDictionaryRuntimeObjs(t)}}]),t}(),H=function(){function t(e){n(this,t),this._seed=e%2147483647,this._seed<=0&&(this._seed+=2147483646)}return a(t,[{key:"next",value:function(){return this._seed=16807*this._seed%2147483647}},{key:"nextFloat",value:function(){return(this.next()-1)/2147483646}}]),t}(),X=function(){function t(e){n(this,t),this.story=e,this._outputStream=[],this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this.OutputStreamDirty(),this._evaluationStack=[],this.callStack=new K(e.rootContentContainer),this._variablesState=new U(this.callStack,e.listDefinitions),this._visitCounts={},this._turnIndices={},this._currentTurnIndex=-1,this.divertedTargetObject=null;var i=(new Date).getTime();this.storySeed=new H(i).next()%100,this.previousRandom=0,this._currentChoices=[],this._currentText=null,this._currentTags=null,this._currentErrors=null,this.didSafeExit=!1,this._isExternalFunctionEvaluation=!1,this._originalCallstack=null,this._originalEvaluationStackHeight=0,this.GoToStart()}return a(t,[{key:"MatchRightGlueForLeftGlue",value:function(t){if(!t.isLeft)return null;for(var e=this._outputStream.length-1;e>=0;e--){var n=this._outputStream[e],i=n;if(i instanceof O&&i.isRight&&i.parent==t.parent)return i;if(n instanceof w)break}return null}},{key:"GoToStart",value:function(){this.callStack.currentElement.currentContainer=this.story.mainContentContainer,this.callStack.currentElement.currentContentIndex=0}},{key:"ResetErrors",value:function(){this._currentErrors=null}},{key:"ResetOutput",value:function(){this._outputStream.length=0,this.OutputStreamDirty()}},{key:"PushEvaluationStack",value:function(t){var e=this,n=t;if(n instanceof b){var i=n.value,a=i.originNames;if(null!=a){var r=[];a.forEach(function(t){var n=null;n=e.story.listDefinitions.TryGetDefinition(t,n),r.indexOf(n)<0&&r.push(n)}),i.origins=r}}this.evaluationStack.push(t)}},{key:"PopEvaluationStack",value:function(t){if(t){if(t>this.evaluationStack.length)throw"trying to pop too many objects";var e=this.evaluationStack.splice(this.evaluationStack.length-t,t);return e}var n=this.evaluationStack.pop();return n}},{key:"PeekEvaluationStack",value:function(){return this.evaluationStack[this.evaluationStack.length-1]}},{key:"PushToOutputStream",value:function(t){var e=this,n=t;if(n instanceof k){var i=this.TrySplittingHeadTailWhitespace(n);if(null!=i)return void i.forEach(function(t){e.PushToOutputStreamIndividual(t)})}this.PushToOutputStreamIndividual(t),this.OutputStreamDirty()}},{key:"TrySplittingHeadTailWhitespace",value:function(t){for(var e=t.value,n=-1,i=-1,a=0;a<e.length;++a){var r=e[a];if("\n"!=r){if(" "==r||"\t"==r)continue;break}n==-1&&(n=a),i=a}for(var o=-1,s=-1,a=0;a<e.length;++a){var r=e[a];if("\n"!=r){if(" "==r||"\t"==r)continue;break}o==-1&&(o=a),s=a}if(n==-1&&o==-1)return null;var u=[],l=0,h=e.length;if(n!=-1){if(n>0){var c=e.substring(0,n);u.push(c)}u.push(new k("\n")),l=i+1}if(o!=-1&&(h=s),h>l){var f=e.substring(l,h-l);u.push(new k(f))}if(o!=-1&&s>i&&(u.push(new k("\n")),o<e.length-1)){var v=e.Length-o-1,d=new k(e.substring(o+1,v));u.push(d)}return u}},{key:"PushToOutputStreamIndividual",value:function(t){var e=t,n=t,i=!0;if(e instanceof O){var a=this.currentRightGlue,r=(!(!e.isLeft||!a||e.parent!=a.parent),null);e.isLeft&&(r=this.MatchRightGlueForLeftGlue(e)),(e.isLeft||e.isBi)&&this.TrimNewlinesFromOutputStream(r),i=e.isBi||e.isRight}else n instanceof k&&(this.currentGlueIndex!=-1?n.isNewline?(this.TrimFromExistingGlue(),i=!1):n.isNonWhitespace&&this.RemoveExistingGlue():n.isNewline&&(!this.outputStreamEndsInNewline&&this.outputStreamContainsContent||(i=!1)));i&&(this._outputStream.push(t),this.OutputStreamDirty())}},{key:"TrimNewlinesFromOutputStream",value:function(t){for(var e=-1,n=-1,i=!1,a=this._outputStream.length-1;a>=0;){var r=this._outputStream[a],o=r,s=r,u=r;if(o instanceof w||s instanceof k&&s.isNonWhitespace){if(i=!0,null==t)break}else{if(t&&u instanceof O&&u==t){n=a;break}s instanceof k&&s.isNewline&&!i&&(e=a)}a--}if(e>=0)for(a=e;a<this._outputStream.length;){var l=this._outputStream[a];l instanceof k?this._outputStream.splice(a,1):a++}if(t&&n>-1)for(a=n;a<this._outputStream.length;)this._outputStream[a]instanceof O&&this._outputStream[a].isRight?this.outputStream.splice(a,1):a++;this.OutputStreamDirty()}},{key:"TrimFromExistingGlue",value:function(){for(var t=this.currentGlueIndex;t<this._outputStream.length;){var e=this._outputStream[t];e instanceof k&&!e.isNonWhitespace?this._outputStream.splice(t,1):t++}this.OutputStreamDirty()}},{key:"RemoveExistingGlue",value:function(){for(var t=this._outputStream.length-1;t>=0;t--){var e=this._outputStream[t];if(e instanceof O)this._outputStream.splice(t,1);else if(e instanceof w)break}this.OutputStreamDirty()}},{key:"ForceEnd",value:function(){for(;this.callStack.canPopThread;)this.callStack.PopThread();for(;this.callStack.canPop;)this.callStack.Pop();this._currentChoices.length=0,this.currentContentObject=null,this.previousContentObject=null,this.didSafeExit=!0}},{key:"SetChosenPath",value:function(t){this._currentChoices.length=0,this.currentPath=t,this._currentTurnIndex++}},{key:"StartExternalFunctionEvaluation",value:function(t,e){this._originalCallstack=this.callStack,this._originalEvaluationStackHeight=this.evaluationStack.length,this.callStack=new K(t),this.callStack.currentElement.type=I.Function,this._variablesState.callStack=this.callStack,this._isExternalFunctionEvaluation=!0,this.PassArgumentsToEvaluationStack(e)}},{key:"PassArgumentsToEvaluationStack",value:function(t){if(null!=t)for(var e=0;e<t.length;e++){if("number"!=typeof t[e]&&"string"!=typeof t[e])throw"ink arguments when calling EvaluateFunction / ChoosePathStringWithParameters  must be int, float or string";this.PushEvaluationStack(y.Create(t[e]))}}},{key:"TryExitExternalFunctionEvaluation",value:function(){return!(!this._isExternalFunctionEvaluation||1!=this.callStack.elements.length||this.callStack.currentElement.type!=I.Function)&&(this.currentContentObject=null,this.didSafeExit=!0,!0)}},{key:"CompleteExternalFunctionEvaluation",value:function(){for(var t=null;this.evaluationStack.length>this._originalEvaluationStackHeight;){var e=this.PopEvaluationStack();null==t&&(t=e)}if(this.callStack=this._originalCallstack,this._originalCallstack=null,this._originalEvaluationStackHeight=0,this._variablesState.callStack=this.callStack,t){if(t instanceof F)return null;var n=t;return n.valueType==d.DivertTarget?n.valueObject.toString():n.valueObject}return null}},{key:"AddError",value:function(t){null==this._currentErrors&&(this._currentErrors=[]),this._currentErrors.push(t)}},{key:"OutputStreamDirty",value:function(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}},{key:"VisitCountAtPathString",value:function(t){var e;return(e=this.visitCounts[t])?e:0}},{key:"Copy",value:function(){var e=new t(this.story);e.outputStream.push.apply(e.outputStream,this._outputStream),this.OutputStreamDirty(),e._currentChoices.push.apply(e._currentChoices,this._currentChoices),this.hasError&&(e.currentErrors=[],e.currentErrors.push.apply(e.currentErrors,this.currentErrors)),e.callStack=new K(this.callStack),this._originalCallstack&&(e._originalCallstack=new K(this._originalCallstack)),e._variablesState=new U(e.callStack,this.story.listDefinitions),e.variablesState.CopyFrom(this.variablesState),e.evaluationStack.push.apply(e.evaluationStack,this.evaluationStack),e._originalEvaluationStackHeight=this._originalEvaluationStackHeight,null!=this.divertedTargetObject&&(e.divertedTargetObject=this.divertedTargetObject),e.previousContentObject=this.previousContentObject,e._isExternalFunctionEvaluation=this._isExternalFunctionEvaluation,e._visitCounts={};for(var n in this._visitCounts)e._visitCounts[n]=this._visitCounts[n];e._turnIndices={};for(var n in this._turnIndices)e._turnIndices[n]=this._turnIndices[n];return e._currentTurnIndex=this.currentTurnIndex,e.storySeed=this.storySeed,e.previousRandom=this.previousRandom,e.didSafeExit=this.didSafeExit,e}},{key:"toJson",value:function(t){return JSON.stringify(this.jsonToken,null,t?2:0)}},{key:"LoadJson",value:function(t){this.jsonToken=JSON.parse(t);
        }},{key:"currentChoices",get:function(){return this.canContinue?[]:this._currentChoices}},{key:"generatedChoices",get:function(){return this._currentChoices}},{key:"currentErrors",get:function(){return this._currentErrors}},{key:"visitCounts",get:function(){return this._visitCounts}},{key:"turnIndices",get:function(){return this._turnIndices}},{key:"currentTurnIndex",get:function(){return this._currentTurnIndex}},{key:"variablesState",get:function(){return this._variablesState}},{key:"currentContentObject",get:function(){return this.callStack.currentElement.currentObject},set:function(t){this.callStack.currentElement.currentObject=t}},{key:"canContinue",get:function(){return null!=this.currentContentObject&&!this.hasError}},{key:"hasError",get:function(){return null!=this.currentErrors&&this.currentErrors.length>0}},{key:"inExpressionEvaluation",get:function(){return this.callStack.currentElement.inExpressionEvaluation},set:function(t){this.callStack.currentElement.inExpressionEvaluation=t}},{key:"evaluationStack",get:function(){return this._evaluationStack}},{key:"outputStreamEndsInNewline",get:function(){if(this._outputStream.length>0)for(var t=this._outputStream.length-1;t>=0;t--){var e=this._outputStream[t];if(e instanceof w)break;var n=this._outputStream[t];if(n instanceof k){if(n.isNewline)return!0;if(n.isNonWhitespace)break}}return!1}},{key:"outputStreamContainsContent",get:function(){for(var t=0;t<this._outputStream.length;t++)if(this._outputStream[t]instanceof k)return!0;return!1}},{key:"currentGlueIndex",get:function(){for(var t=this._outputStream.length-1;t>=0;t--){var e=this._outputStream[t],n=e;if(n instanceof O)return t;if(e instanceof w)break}return-1}},{key:"currentRightGlue",get:function(){for(var t=this._outputStream.length-1;t>=0;t--){var e=this._outputStream[t],n=e;if(n instanceof O&&n.isRight)return n;if(e instanceof w)break}return null}},{key:"inStringEvaluation",get:function(){for(var t=this._outputStream.length-1;t>=0;t--){var e=this._outputStream[t];if(e instanceof w&&e.commandType==w.CommandType.BeginString)return!0}return!1}},{key:"currentText",get:function(){if(this._outputStreamTextDirty){var t=new c;this._outputStream.forEach(function(e){var n=e;n instanceof k&&t.Append(n.value)}),this._currentText=t.toString(),this._outputStreamTextDirty=!1}return this._currentText}},{key:"currentTags",get:function(){var t=this;return this._outputStreamTagsDirty&&(this._currentTags=[],this._outputStream.forEach(function(e){var n=e;n instanceof j&&t._currentTags.push(n.text)}),this._outputStreamTagsDirty=!1),this._currentTags}},{key:"outputStream",get:function(){return this._outputStream}},{key:"currentPath",get:function(){return null==this.currentContentObject?null:this.currentContentObject.path},set:function(t){null!=t?this.currentContentObject=this.story.ContentAtPath(t):this.currentContentObject=null}},{key:"currentContainer",get:function(){return this.callStack.currentElement.currentContainer}},{key:"previousContentObject",get:function(){return this.callStack.currentThread.previousContentObject},set:function(t){this.callStack.currentThread.previousContentObject=t}},{key:"callstackDepth",get:function(){return this.callStack.depth}},{key:"jsonToken",get:function(){var e=this,n={},i=null;return this._currentChoices.forEach(function(t){t.originalChoicePath=t.choicePoint.path.componentsString,t.originalThreadIndex=t.threadAtGeneration.threadIndex,null==e.callStack.ThreadWithIndex(t.originalThreadIndex)&&(null==i&&(i={}),i[t.originalThreadIndex.toString()]=t.threadAtGeneration.jsonToken)}),null!=this.choiceThreads&&(n.choiceThreads=this.choiceThreads),n.callstackThreads=this.callStack.GetJsonToken(),n.variablesState=this.variablesState.jsonToken,n.evalStack=G.ListToJArray(this.evaluationStack),n.outputStream=G.ListToJArray(this._outputStream),n.currentChoices=G.ListToJArray(this._currentChoices),null!=this.divertedTargetObject&&(n.currentDivertTarget=this.divertedTargetObject.path.componentsString),n.visitCounts=G.IntDictionaryToJObject(this.visitCounts),n.turnIndices=G.IntDictionaryToJObject(this.turnIndices),n.turnIdx=this.currentTurnIndex,n.storySeed=this.storySeed,n.inkSaveVersion=t.kInkSaveStateVersion,n.inkFormatVersion=this.story.inkVersionCurrent,n},set:function(e){var n=this,i=e,a=i.inkSaveVersion;if(null==a)throw new T("ink save format incorrect, can't load.");if(parseInt(a)<t.kMinCompatibleLoadVersion)throw new T("Ink save format isn't compatible with the current version (saw '"+a+"', but minimum is "+t.kMinCompatibleLoadVersion+"), so can't load.");this.callStack.SetJsonToken(i.callstackThreads,this.story),this.variablesState.jsonToken=i.variablesState,this._evaluationStack=G.JArrayToRuntimeObjList(i.evalStack),this._outputStream=G.JArrayToRuntimeObjList(i.outputStream),this.OutputStreamDirty(),this._currentChoices=G.JArrayToRuntimeObjList(i.currentChoices);var r=i.currentDivertTarget;if(null!=r){var o=new u(r.toString());this.divertedTargetObject=this.story.ContentAtPath(o)}this._visitCounts=G.JObjectToIntDictionary(i.visitCounts),this._turnIndices=G.JObjectToIntDictionary(i.turnIndices),this._currentTurnIndex=parseInt(i.turnIdx),this.storySeed=parseInt(i.storySeed);var s=i.choiceThreads;this._currentChoices.forEach(function(t){t.choicePoint=n.story.ContentAtPath(new u(t.originalChoicePath));var e=n.callStack.ThreadWithIndex(t.originalThreadIndex);if(null!=e)t.threadAtGeneration=e;else{var i=s[t.originalThreadIndex.toString()];t.threadAtGeneration=new K.Thread(i,n.story)}})}}]),t}();X.kInkSaveStateVersion=7,X.kMinCompatibleLoadVersion=6,Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});var $=function(t){function i(t,e){n(this,i);var a=s(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));if(e=e||null,a.inkVersionCurrent=17,a.inkVersionMinimumCompatible=16,a._variableObservers=null,a._externals={},a._prevContainerSet=null,a._listDefinitions=null,t instanceof _)a._mainContentContainer=t,null!=e&&(a._listDefinitions=new B(e));else{var r="string"==typeof t?JSON.parse(t):t,o=r.inkVersion;if(null==o)throw"ink version number not found. Are you sure it's a valid .ink.json file?";var u=parseInt(o);if(u>a.inkVersionCurrent)throw"Version of ink used to build story was newer than the current verison of the engine";if(u<a.inkVersionMinimumCompatible)throw"Version of ink used to build story is too old to be loaded by this verison of the engine";u!=a.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");var l=r.root;if(null==l)throw"Root node for ink not found. Are you sure it's a valid .ink.json file?";var h;(h=r.listDefs)&&(a._listDefinitions=G.JTokenToListDefinitions(h)),a._mainContentContainer=G.JTokenToRuntimeObject(l),a._hasValidatedExternals=null,a.allowExternalFunctionFallbacks=!1,a.ResetState()}return a}return o(i,t),a(i,[{key:"ToJsonString",value:function(){var t=G.RuntimeObjectToJToken(this._mainContentContainer),e={};return e.inkVersion=this.inkVersionCurrent,e.root=t,null!=this._listDefinitions&&(e.listDefs=G.ListDefinitionsToJToken(this._listDefinitions)),JSON.stringify(e)}},{key:"ResetState",value:function(){this._state=new X(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}},{key:"ResetErrors",value:function(){this._state.ResetErrors()}},{key:"ResetCallstack",value:function(){this._state.ForceEnd()}},{key:"ResetGlobals",value:function(){if(this._mainContentContainer.namedContent["global decl"]){var t=this.state.currentPath;this.ChoosePathString("global decl"),this.ContinueInternal(),this.state.currentPath=t}}},{key:"Continue",value:function(){return this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal()}},{key:"ContinueInternal",value:function(){if(!this.canContinue)throw new T("Can't continue - should check canContinue before calling Continue");this._state.ResetOutput(),this._state.didSafeExit=!1,this._state.variablesState.batchObservingVariableChanges=!0;try{var t=null;do if(this.Step(),this.canContinue||this.TryFollowDefaultInvisibleChoice(),!this.state.inStringEvaluation){if(null!=t){var e=this.currentText,n=t.currentText.length,i=t.currentTags.length;if(e!==t.currentText||i!=this.currentTags.length){if(e.length>=n&&"\n"==e[n-1]){this.RestoreStateSnapshot(t);break}t=null}}this.state.outputStreamEndsInNewline&&(this.canContinue?null==t&&(t=this.StateSnapshot()):t=null)}while(this.canContinue);null!=t&&this.RestoreStateSnapshot(t),this.canContinue||(this.state.callStack.canPopThread&&this.Error("Thread available to pop, threads should always be flat by the end of evaluation?"),0!=this.state.generatedChoices.length||this.state.didSafeExit||null!=this._temporaryEvaluationContainer||(this.state.callStack.CanPop(I.Tunnel)?this.Error("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(I.Function)?this.Error("unexpectedly reached end of content. Do you need a '~ return'?"):this.state.callStack.canPop?this.Error("unexpectedly reached end of content for unknown reason. Please debug compiler!"):this.Error("ran out of content. Do you need a '-> DONE' or '-> END'?")))}catch(t){throw t}finally{this.state.didSafeExit=!1,this._state.variablesState.batchObservingVariableChanges=!1}return this.currentText}},{key:"ContinueMaximally",value:function(){for(var t=new c;this.canContinue;)t.Append(this.Continue());return t.toString()}},{key:"ContentAtPath",value:function(t){return this.mainContentContainer.ContentAtPath(t)}},{key:"StateSnapshot",value:function(){return this.state.Copy()}},{key:"RestoreStateSnapshot",value:function(t){this._state=t}},{key:"Step",value:function(){var t=!0,e=this.state.currentContentObject;if(null!=e){for(var n=e;n instanceof _&&(this.VisitContainer(n,!0),0!=n.content.length);)e=n.content[0],this.state.callStack.currentElement.currentContentIndex=0,this.state.callStack.currentElement.currentContainer=n,n=e;n=this.state.callStack.currentElement.currentContainer;var i=this.PerformLogicAndFlowControl(e);if(null!=this.state.currentContentObject){i&&(t=!1);var a=e;if(a instanceof A){var r=this.ProcessChoice(a);r&&this.state.generatedChoices.push(r),e=null,t=!1}if(e instanceof _&&(t=!1),t){var o=e;if(o instanceof S&&o.contextIndex==-1){var s=this.state.callStack.ContextForVariableNamed(o.variableName);e=new S(o.variableName,s)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(e):this.state.PushToOutputStream(e)}this.NextContent();var u=e;u instanceof w&&u.commandType==w.CommandType.StartThread&&this.state.callStack.PushThread()}}}},{key:"VisitContainer",value:function(t,e){t.countingAtStartOnly&&!e||(t.visitsShouldBeCounted&&this.IncrementVisitCountForContainer(t),t.turnIndexShouldBeCounted&&this.RecordTurnIndexVisitToContainer(t))}},{key:"VisitChangedContainersDueToDivert",value:function(){var t=this.state.previousContentObject,e=this.state.currentContentObject;if(e){if(this._prevContainerSet=[],t)for(var n=t instanceof _?t:t.parent;n instanceof _;)this._prevContainerSet.push(n),n=n.parent;for(var i=e,a=i.parent;a instanceof _&&this._prevContainerSet.indexOf(a)<0;){var r=a.content.length>0&&i==a.content[0];this.VisitContainer(a,r),i=a,a=a.parent}}}},{key:"ProcessChoice",value:function(t){var e=!0;if(t.hasCondition){var n=this.state.PopEvaluationStack();this.IsTruthy(n)||(e=!1)}var i="",a="";if(t.hasChoiceOnlyContent){var r=this.state.PopEvaluationStack();a=r.value}if(t.hasStartContent){var o=this.state.PopEvaluationStack();i=o.value}if(t.onceOnly){var s=this.VisitCountForContainer(t.choiceTarget);s>0&&(e=!1)}var u=new R(t);return u.threadAtGeneration=this.state.callStack.currentThread.Copy(),e?(u.text=i+a,u):null}},{key:"IsTruthy",value:function(t){var e=!1;if(t instanceof y){var n=t;if(n instanceof C){var i=n;return this.Error("Shouldn't use a divert target (to "+i.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1}return n.isTruthy}return e}},{key:"PerformLogicAndFlowControl",value:function(t){if(null==t)return!1;if(t instanceof P){var e=t;if(e.isConditional){var n=this.state.PopEvaluationStack();if(!this.IsTruthy(n))return!0}if(e.hasVariableTarget){var i=e.variableDivertName,a=this.state.variablesState.GetVariableWithName(i);if(!(a instanceof C)){var r=a,o="Tried to divert to a target from a variable, but the variable ("+i+") didn't contain a divert target, it ";o+=r instanceof m&&0==r.value?"was empty/null (the value 0).":"contained '"+a+"'.",this.Error(o)}var s=a;this.state.divertedTargetObject=this.ContentAtPath(s.targetPath)}else{if(e.isExternal)return this.CallExternalFunction(e.targetPathString,e.externalArgs),!0;this.state.divertedTargetObject=e.targetContent}return e.pushesToStack&&this.state.callStack.Push(e.stackPushType),null!=this.state.divertedTargetObject||e.isExternal||(e&&null!=e.debugMetadata.sourceName?this.Error("Divert target doesn't exist: "+e.debugMetadata.sourceName):this.Error("Divert resolution failed: "+e)),!0}if(t instanceof w){var u=t;switch(u.commandType){case w.CommandType.EvalStart:this.state.inExpressionEvaluation&&console.warn("Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case w.CommandType.EvalEnd:this.state.inExpressionEvaluation||console.warn("Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case w.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){var l=this.state.PopEvaluationStack();if(null!=l&&!(l instanceof F)){var h=new k(l.toString());this.state.PushToOutputStream(h)}}break;case w.CommandType.NoOp:break;case w.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case w.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case w.CommandType.PopFunction:case w.CommandType.PopTunnel:var f=u.commandType==w.CommandType.PopFunction?I.Function:I.Tunnel,v=null;if(f==I.Tunnel){var d=this.state.PopEvaluationStack();if(v=d,v instanceof C==!1){if(d instanceof F==!1)throw"Expected void if ->-> doesn't override target";v=null}}if(this.state.TryExitExternalFunctionEvaluation())break;if(this.state.callStack.currentElement.type==f&&this.state.callStack.canPop)this.state.callStack.Pop(),v&&(this.state.divertedTargetObject=this.ContentAtPath(v.targetPath));else{var p={};p[I.Function]="function return statement (~ return)",p[I.Tunnel]="tunnel onwards statement (->->)";var y=p[this.state.callStack.currentElement.type];this.state.callStack.canPop||(y="end of flow (-> END or choice)");var g="Found "+p[f]+", when expected "+y;this.Error(g)}break;case w.CommandType.BeginString:this.state.PushToOutputStream(u),this.state.inExpressionEvaluation||console.warn("Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case w.CommandType.EndString:for(var S=[],_=0,O=this.state.outputStream.length-1;O>=0;--O){var E=this.state.outputStream[O];_++;var x=E;if(x instanceof w&&x.commandType==w.CommandType.BeginString)break;E instanceof k&&S.push(E)}this.state.outputStream.splice(this.state.outputStream.length-_,_),S=S.reverse();var A=new c;S.forEach(function(t){A.Append(t.toString())}),this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new k(A.toString()));break;case w.CommandType.ChoiceCount:var j=this.state.generatedChoices.length;this.state.PushEvaluationStack(new m(j));break;case w.CommandType.TurnsSince:case w.CommandType.ReadCount:var s=this.state.PopEvaluationStack();if(!(s instanceof C)){var R="";s instanceof m&&(R=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+s+R);break}var D,B=s,G=this.ContentAtPath(B.targetPath);D=u.commandType==w.CommandType.TurnsSince?this.TurnsSinceForContainer(G):this.VisitCountForContainer(G),this.state.PushEvaluationStack(new m(D));break;case w.CommandType.Random:var J=this.state.PopEvaluationStack(),M=this.state.PopEvaluationStack();null!=M&&M instanceof m!=!1||this.Error("Invalid value for minimum parameter of RANDOM(min, max)"),null!=J&&M instanceof m!=!1||this.Error("Invalid value for maximum parameter of RANDOM(min, max)");var W=J.value-M.value+1;W<=0&&this.Error("RANDOM was called with minimum as "+M.value+" and maximum as "+J.value+". The maximum must be larger");var q=this.state.storySeed+this.state.previousRandom,K=new H(q),U=K.next(),X=U%W+M.value;this.state.PushEvaluationStack(new m(X)),this.state.previousRandom=U;break;case w.CommandType.SeedRandom:var $=this.state.PopEvaluationStack();null!=$&&$ instanceof m!=!1||this.Error("Invalid value passed to SEED_RANDOM"),this.state.storySeed=$.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new F);break;case w.CommandType.VisitIndex:var z=this.VisitCountForContainer(this.state.currentContainer)-1;this.state.PushEvaluationStack(new m(z));break;case w.CommandType.SequenceShuffleIndex:var Q=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new m(Q));break;case w.CommandType.StartThread:break;case w.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentContentObject=null);break;case w.CommandType.End:this.state.ForceEnd();break;case w.CommandType.ListFromInt:var Y,Z=parseInt(this.state.PopEvaluationStack()),tt=this.state.PopEvaluationStack().toString(),et=null;if(!(Y=this.listDefinitions.TryGetDefinition(tt,Y)))throw new T("Failed to find LIST called "+tt.value);var nt=Y.TryGetItemWithValue(Z.value);nt.exists&&(et=new b(nt.item,Z.value)),null==et&&(et=new b),this.state.PushEvaluationStack(et);break;case w.CommandType.ListRange:var it=this.state.PopEvaluationStack(),at=this.state.PopEvaluationStack(),rt=this.state.PopEvaluationStack();if(rt instanceof b==!1||null==rt||null==at||null==it)throw new T("Expected list, minimum and maximum for LIST_RANGE");var ot=function(t){var e=t;if(e instanceof b)return parseInt(e.value.maxItem.Value);var n=t;return n instanceof m?n.value:-1},st=ot(at),ut=ot(it);if(st==-1)throw new T("Invalid min range bound passed to LIST_VALUE(): "+at);if(ut==-1)throw new T("Invalid max range bound passed to LIST_VALUE(): "+it);var lt=new b,ht=rt.value.origins;null!=ht&&ht.forEach(function(t){var e=t.ListRange(st,ut);e.value.forEach(function(t){lt.value.Add(t.Key,t.Value)})}),this.state.PushEvaluationStack(lt);break;default:this.Error("unhandled ControlCommand: "+u)}return!0}if(t instanceof V){var ct=t,ft=this.state.PopEvaluationStack();return this.state.variablesState.Assign(ct,ft),!0}if(t instanceof N){var vt=t,dt=null;if(null!=vt.pathForCount){var G=vt.containerForCount,z=this.VisitCountForContainer(G);dt=new m(z)}else dt=this.state.variablesState.GetVariableWithName(vt.name),null==dt&&(this.Error("Uninitialised variable: "+vt.name),dt=new m(0));return this.state.PushEvaluationStack(dt),!0}if(t instanceof L){var pt=t,yt=this.state.PopEvaluationStack(pt.numberOfParameters),lt=pt.Call(yt);return this.state.PushEvaluationStack(lt),!0}return!1}},{key:"ChoosePathString",value:function(t,e){e=e||[],this.state.PassArgumentsToEvaluationStack(e),this.ChoosePath(new u(t))}},{key:"ChoosePath",value:function(t){this.state.SetChosenPath(t),this.VisitChangedContainersDueToDivert()}},{key:"ChooseChoiceIndex",value:function(t){t=t;var e=this.currentChoices;(t<0||t>e.length)&&console.warn("choice out of range");var n=e[t];this.state.callStack.currentThread=n.threadAtGeneration,this.ChoosePath(n.choicePoint.choiceTarget.path)}},{key:"HasFunction",value:function(t){try{return this.ContentAtPath(new u(t))instanceof _}catch(t){return!1}}},{key:"EvaluateFunction",value:function(t,e,n){if(n=!!n,null==t)throw"Function is null";if(""==t||""==t.trim())throw"Function is empty or white space.";var i=null;try{i=this.ContentAtPath(new u(t))}catch(e){throw e.message.indexOf("not found")>=0?"Function doesn't exist: '"+t+"'":e}this.state.StartExternalFunctionEvaluation(i,e);for(var a=new c;this.canContinue;)a.Append(this.Continue());var r=a.toString(),o=this.state.CompleteExternalFunctionEvaluation();return n?{returned:o,output:r}:o}},{key:"EvaluateExpression",value:function(t){var e=this.state.callStack.elements.length;this.state.callStack.Push(I.Tunnel),this._temporaryEvaluationContainer=t,this.state.GoToStart();var n=this.state.evaluationStack.length;this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>e&&this.state.callStack.Pop();var i=this.state.evaluationStack.length;return i>n?this.state.PopEvaluationStack():null}},{key:"CallExternalFunction",value:function(t,n){var i=this._externals[t],a=null,r="undefined"!=typeof i;if(!r){if(this.allowExternalFunctionFallbacks)return a=this.ContentAtPath(new u(t)),a instanceof _||console.warn("Trying to call EXTERNAL function '"+t+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(I.Function),void(this.state.divertedTargetObject=a);console.warn("Trying to call EXTERNAL function '"+t+"' which has not been bound (and ink fallbacks disabled).")}for(var o=[],s=0;s<n;++s){var l=this.state.PopEvaluationStack(),h=l.valueObject;o.push(h)}o.reverse();var c=i(o),f=null;null!=c?(f=y.Create(c),null==f&&console.warn("Could not create ink value from returned object of type "+("undefined"==typeof c?"undefined":e(c)))):f=new F,this.state.PushEvaluationStack(f)}},{key:"TryCoerce",value:function(t){return t}},{key:"BindExternalFunctionGeneral",value:function(t,e){this._externals[t]&&console.warn("Function '"+t+"' has already been bound."),this._externals[t]=e}},{key:"BindExternalFunction",value:function(t,e){var n=this;e||console.warn("Can't bind a null function"),this.BindExternalFunctionGeneral(t,function(t){t.length<e.length&&console.warn("External function expected "+e.length+" arguments");for(var i=[],a=0,r=t.length;a<r;a++)i[a]=n.TryCoerce(t[a]);return e.apply(null,i)})}},{key:"UnbindExternalFunction",value:function(t){"undefined"==typeof this._externals[t]&&console.warn("Function '"+t+"' has not been bound."),delete this._externals[t]}},{key:"ValidateExternalBindings",value:function(t,e){var n=this;if(t)if(t instanceof _){var i=t;i.content.forEach(function(t){n.ValidateExternalBindings(t,e)});for(var a in i.namedContent)this.ValidateExternalBindings(i.namedContent[a],e)}else{var r=t,o=r;if(o instanceof P&&o.isExternal){var s=o.targetPathString;if(!this._externals[s])if(this.allowExternalFunctionFallbacks){var u=!!this.mainContentContainer.namedContent[s];u||e.push(s)}else e.push(s)}}else{var e=[];if(this.ValidateExternalBindings(this._mainContentContainer,e),this._hasValidatedExternals=!0,0==e.length)this._hasValidatedExternals=!0;else{var l="Error: Missing function binding for external";l+=e.length>1?"s":"",l+=": '",l+=e.join("', '"),l+="' ",l+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)",this.Error(l)}}}},{key:"ObserveVariable",value:function(t,e){null==this._variableObservers&&(this._variableObservers={}),this._variableObservers[t]?this._variableObservers[t].push(e):this._variableObservers[t]=[e]}},{key:"ObserveVariables",value:function(t,e){for(var n=0,i=t.length;n<i;n++)this.ObserveVariable(t[n],e[n])}},{key:"RemoveVariableObserver",value:function(t,e){if(null!=this._variableObservers)if("undefined"!=typeof e)this._variableObservers[e]&&this._variableObservers[e].splice(this._variableObservers[e].indexOf(t),1);else for(var n in this._variableObservers)this._variableObservers[n].splice(this._variableObservers[n].indexOf(t),1)}},{key:"VariableStateDidChangeEvent",value:function(t,e){if(null!=this._variableObservers){var n=this._variableObservers[t];if("undefined"!=typeof n){if(!(e instanceof y))throw"Tried to get the value of a variable that isn't a standard type";var i=e;n.forEach(function(e){e(t,i.valueObject)})}}}},{key:"TagsForContentAtPath",value:function(t){return this.TagsAtStartOfFlowContainerWithPathString(t)}},{key:"TagsAtStartOfFlowContainerWithPathString",value:function(t){for(var e=new u(t),n=this.ContentAtPath(e);;){var i=n.content[0];if(!(i instanceof _))break;n=i}var a=null;return n.content.every(function(t){var e=t;return e instanceof j&&(null==a&&(a=[]),a.push(e.text),!0)}),a}},{key:"BuildStringOfHierarchy",value:function(){var t=new c;return this.mainContentContainer.BuildStringOfHierarchy(t,0,this.state.currentContentObject),t.toString()}},{key:"BuildStringOfContainer",value:function(t){var e=new c;return t.BuildStringOfHierarchy(e,0,this.state.currentContentObject),e.toString()}},{key:"NextContent",value:function(){if(this.state.previousContentObject=this.state.currentContentObject,null==this.state.divertedTargetObject||(this.state.currentContentObject=this.state.divertedTargetObject,this.state.divertedTargetObject=null,this.VisitChangedContainersDueToDivert(),null==this.state.currentContentObject)){var t=this.IncrementContentPointer();if(!t){var e=!1;this.state.callStack.CanPop(I.Function)?(this.state.callStack.Pop(I.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new F),e=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),e=!0):this.state.TryExitExternalFunctionEvaluation(),e&&null!=this.state.currentContentObject&&this.NextContent()}}}},{key:"IncrementContentPointer",value:function(){var t=!0,e=this.state.callStack.currentElement;for(e.currentContentIndex++;e.currentContentIndex>=e.currentContainer.content.length;){t=!1;var n=e.currentContainer.parent;if(n instanceof _==!1)break;var i=n.content.indexOf(e.currentContainer);if(i==-1)break;e.currentContainer=n,e.currentContentIndex=i+1,t=!0}return t||(e.currentContainer=null),t}},{key:"TryFollowDefaultInvisibleChoice",value:function(){var t=this._state.currentChoices,e=t.filter(function(t){return t.choicePoint.isInvisibleDefault});if(0==e.length||t.length>e.length)return!1;var n=e[0];return this.ChoosePath(n.choicePoint.choiceTarget.path),!0}},{key:"VisitCountForContainer",value:function(t){if(!t.visitsShouldBeCounted)return console.warn("Read count for target ("+t.name+" - on "+t.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;var e=0,n=t.path.toString();return e=this.state.visitCounts[n]||e}},{key:"IncrementVisitCountForContainer",value:function(t){var e=0,n=t.path.toString();this.state.visitCounts[n]&&(e=this.state.visitCounts[n]),e++,this.state.visitCounts[n]=e}},{key:"RecordTurnIndexVisitToContainer",value:function(t){var e=t.path.toString();this.state.turnIndices[e]=this.state.currentTurnIndex}},{key:"TurnsSinceForContainer",value:function(t){t.turnIndexShouldBeCounted||this.Error("TURNS_SINCE() for target ("+t.name+" - on "+t.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c).");var e=t.path.toString(),n=this.state.turnIndices[e];return"undefined"!=typeof n?this.state.currentTurnIndex-n:-1}},{key:"NextSequenceShuffleIndex",value:function(){var t=this.state.PopEvaluationStack();if(!(t instanceof m))return this.Error("expected number of elements in sequence for shuffle index"),0;for(var e=this.state.currentContainer,n=t.value,i=this.state.PopEvaluationStack(),a=i.value,r=a/n,o=a%n,s=e.path.toString(),u=0,l=0,h=s.length;l<h;l++)u+=s.charCodeAt[l]||0;for(var c=u+r+this.state.storySeed,f=new H(parseInt(c)),v=[],l=0;l<n;++l)v.push(l);for(var l=0;l<=o;++l){var d=f.next()%v.length,p=v[d];if(v.splice(d,1),l==o)return p}throw"Should never reach here"}},{key:"Error",value:function(t,e){var n=new T(t);throw n}},{key:"AddError",value:function(t,e){var n=null;if(null!=n){var i=e?n.endLineNumber:n.startLineNumber;t="RUNTIME ERROR: '"+n.fileName+"' line "+i+": "+t}else t="RUNTIME ERROR: "+t;this.state.AddError(t),this.state.ForceEnd()}},{key:"currentChoices",get:function(){var t=[];return this._state.currentChoices.forEach(function(e){e.choicePoint.isInvisibleDefault||(e.index=t.length,t.push(e))}),t}},{key:"currentText",get:function(){return this.state.currentText}},{key:"currentTags",get:function(){return this.state.currentTags}},{key:"currentErrors",get:function(){return this.state.currentErrors}},{key:"hasError",get:function(){return this.state.hasError}},{key:"variablesState",get:function(){return this.state.variablesState}},{key:"listDefinitions",get:function(){return this._listDefinitions}},{key:"state",get:function(){return this._state}},{key:"mainContentContainer",get:function(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}},{key:"canContinue",get:function(){return this.state.canContinue}},{key:"globalTags",get:function(){return this.TagsAtStartOfFlowContainerWithPathString("")}}]),i}(h);t.Story=$,Object.defineProperty(t,"__esModule",{value:!0})});
    </script>
    <!-- Challenge and change.js -->
    <script language="javascript" type="text/javascript">
        // Challenge and change.js
        var storyContent = { "inkVersion": 17, "root": ["^Welcome to the Open Educational Resources (OER) choose your own adventure story.", "\n", "^If you're hoping to find all the answers of what the library should be doing to support the use of OER at the University here then you're in the wrong place. However if you would like to experience an exploration of the topic then please go ahead...", "\n", "^Select a player:", "\n", ["ev", "str", "^The most enthusiastic student in the world", "/str", "/ev", { "*": "6.c", "flg": 20 }, { "c": ["\n", { "->": "student" }, "\n", { "#f": 7 }] }], ["ev", "str", "^An OER curious academic", "/str", "/ev", { "*": "7.c", "flg": 20 }, { "c": ["\n", { "->": "academic" }, "\n", { "#f": 7 }] }], ["ev", "str", "^A librarian with lots of ideas about encouraging the use of OER", "/str", "/ev", { "*": "8.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Busy library executive who just wants to skip to the point", "/str", "/ev", { "*": "9.c", "flg": 20 }, { "c": ["\n", { "->": "executive" }, "\n", { "#f": 7 }] }], "done", { "student": ["^As the most enthusiastic student in the world I'm super excited about starting University. I'm going to be really organised, study hard and learn lots of new things.", "\n", "^I wonder if I should look at what the required resources are for my course?", "\n", ["ev", "str", "^Look at list", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.list" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Don't look at list", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.no_list" }, "\n", { "#f": 7 }] }], { "list": ["^Okay, so most of my courses have pretty standard textbooks listed for me to buy from the book shop.", "\n", "^But one of my courses says it is going to use OERs. I wonder what they are?", "\n", ["ev", "str", "^Go shopping for your textbooks", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.textbooks" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Find out what OERs are", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.oer" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "textbooks": ["^Oh no! All these textbooks are astronomically expensive and I'm only a poor student. What should I do?", "\n", ["ev", "str", "^Buy them all anyway", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.buy" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Muddle through without them", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.muddle" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Borrow them from the library", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.library" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "buy": ["^I guess I'll just have to cut all fruit and vegetables from my diet and survive on 2 minute noodles in order to buy them.", "\n", ["ev", "str", "^View your resuls", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.results_buy" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "results_buy": ["^I'm pretty happy with my results but am feeling weak and who knew that scurvey was still a thing!", "\n", "^One of my friends told me that in one of their courses the academic used OERs which they didn't have to pay for.", "\n", "^It would be great if more academics used OERs. I wonder if the library could help with that?", "\n", ["ev", "str", "^No, that's a silly idea", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.silly" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That sounds fantastic - I'll play as a librarian", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "silly": ["^If you really believe that the library has no role to play then you lack imagination.", "\n", ["ev", "str", "^Proceed to exit here", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "muddle": ["^There is no way I can afford to buy those books! I'm just going to have to muddle through without them. Surely it can't make that much difference if I'm smart, enthusiastic and go to all the classes, can it?", "\n", ["ev", "str", "^View your results", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.results_muddle" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "results_muddle": ["^That's disappointing. I thought I'd do better then that although I did feel at a disadvantage to the other students who could afford to buy the textbook.", "\n", "^One of my friends told me that in one of their courses the academic used OERs which they didn't have to pay for.", "\n", "^It would be great if more academics used OERs. I wonder if the library could help with that?", "\n", ["ev", "str", "^No, that's a silly idea", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.silly" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That sounds fantastic - I'll play as a librarian", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "library": ["^I'll just use the library, luckily they have the textbook I need in both print and as an eBook. How great are they!", "\n", ["ev", "str", "^I'll go to the library and borrow a copy", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.borrow" }, "\n", { "#f": 7 }] }], ["ev", "str", "^I'll have a look at the ebook", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.ebook" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "ebook": ["^What! Why can't I access this. It says it should be available online. What's the point of an ebook if only 3 people can look at it at the same time! I can't even download it and it only lets me print and copy a tiny amount. This is not what I expected. I'm very unhappy.", "\n", ["ev", "str", "^I guess I will have to go to the library to borrow a copy", "/str", { "CNT?": ".^.^.^.borrow" }, "!", "/ev", { "*": ".^.c", "flg": 21 }, { "c": ["\n", { "->": "student.borrow" }, "\n", { "#f": 7 }] }], ["ev", { "CNT?": ".^.^" }, { "CNT?": ".^.^.^.borrow" }, "&&", "/ev", { "*": ".^.c", "flg": 9 }, { "c": ["\n", { "->": "student.library_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "borrow": ["^I'm too late already and all the copies are gone even the annoying 3 hour copy.", "\n", ["ev", "str", "^I guess I will have to look at the ebook", "/str", { "CNT?": ".^.^.^.ebook" }, "!", "/ev", { "*": ".^.c", "flg": 21 }, { "c": ["\n", { "->": "student.ebook" }, "\n", { "#f": 7 }] }], ["ev", { "CNT?": ".^.^.^.ebook" }, { "CNT?": ".^.^" }, "&&", "/ev", { "*": ".^.c", "flg": 9 }, { "c": ["\n", { "->": "student.library_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "library_results": [["ev", "str", "^View your results", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.library_results_view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "library_results_view": ["^That's disappointing. I thought I'd do better then that although I did feel at a disadvantage to the other students who could afford to buy the textbooks.", "\n", "^One of my friends told me that in one of their courses the academic used OERs which they didn't have to pay for.", "\n", "^It would be great if more academics used OERs. I wonder if the library could help with that?", "\n", ["ev", "str", "^No, that's a silly idea", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.silly" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That sounds fantastic - I'll play as a librarian", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "oer": ["^Wow! So it turns out that OERs are free stuff which I can reuse, revise, remix, redistribute and retain.", "\n", "^It means I'm even able to access them before my course starts which obviously I'm going to do because I'm the most enthusiastic student in the world!", "\n", "^Apparently they're even going to form some integral part of our assessment.", "\n", ["ev", "str", "^That sounds fantastic", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.fantastic" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That sounds like a drag", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.drag" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "fantastic": ["^The assessment was great, we found, adapted and created our own OERs. The academic is even going to use them in the course the next time it's taught.", "\n", "^I loved the co-creation aspect and knowing that I was working on something which is going to be used and it means I've got something I can put in my e-portfolio to demostrate my digital literacy skills.", "\n", ["ev", "str", "^View your results", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.results_fantastic" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "results_fantastic": ["^I'm super excited about my results and that I've got a tangible output which demostrates my skills.", "\n", "^It would be great if more academics used OERs. I wonder if the library could help with that?", "\n", ["ev", "str", "^No, that's a silly idea", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.silly" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That sounds fantastic - I'll play as a librarian", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "drag": ["^Why should I have to help find, adapt and create an OERs for the academic to use in the class next time? They just seem lazy to me. I'm not going to put any effort into this assessment.", "\n", ["ev", "str", "^View your results", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.results_drag" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "results_drag": ["^I guess I did okay but I probably should have engaged with the co-creation aspect more. Other people in the course created some really great stuff which they've been able to include in their e-portfolio to demostrate their digital literacy skills.", "\n", "^I did love the free textbook and think it would great if more academics used OERs. I wonder if the library could help with that?", "\n", ["ev", "str", "^No, that's a silly idea", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.silly" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That sounds fantastic - I'll play as a librarian", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "no_list": ["^Actually I don't think I'll bother. I'll be fine winging it.", "\n", ["ev", "str", "^View your results", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student.results_no_list" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "results_no_list": ["^That's disappointing. I didn't do anywhere near as well as I'd hoped. Maybe I'm not actually the most enthusiastic student in the world", "\n", ["ev", "str", "^Proceed to exit here", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "#f": 3 }], "academic": ["^As a busy academic it's difficult to find the time to prepare for teaching. I'm currently working out what resources I'm going to use in an upcoming course and I've heard the term OERs mentioned.", "\n", "^I'm curious but don't really know what they're all about. What should I do?", "\n", ["ev", "str", "^Stick with the usual textbook", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.textbook" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Talk to other people who know about OER", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.oer" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Find out if the library can help", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.library" }, "\n", { "#f": 7 }] }], { "textbook": ["^I think I'll just stick to the usual commercial textbook. It's too hard to change now and I don't have the time.", "\n", ["ev", "str", "^I better check how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.textbook_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "textbook_results": ["^That's disappointing. Some of the students don't seem to be doing as well as I would have expected. I wonder what could be contributing to their poor results?", "\n", ["ev", "str", "^They must be lazy", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.lazy" }, "\n", { "#f": 7 }] }], ["ev", "str", "^They don't have the textbook", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.no_textbook" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "lazy": ["^I'm going to assume that they're all unmotivated millenials that haven't bothered doing any of the work.", "\n", "^Although the library did contact me about some project were they looked at data around textbook use, cost and student numbers.", "\n", "^Apparently they can offer help and support for finding, adopting, and adapting OERs.", "\n", ["ev", "str", "^Maybe I should find out more", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Oh well, that's their business - there's no need for me to change my ways", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.no_change" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "no_change": [["ev", "str", "^Maybe you need to play as a student", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student" }, "\n", { "#f": 7 }] }], ["ev", "str", "^No thanks, you've wasted enough of my time", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.waste" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "waste": ["^Fine, If you're giving up already then I have nothing more to say to you.", "\n", ["ev", "str", "^Proceed to exit here", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "no_textbook": ["^A lot of the students say they're struggling because they can't afford to purchase the textbook. Now I feel really bad for not looking into Open Educational Resources.", "\n", ["ev", "str", "^I'll talk to other people who know about OER", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer" }, "\n", { "#f": 7 }] }], ["ev", "str", "^I'll find out if the library can help", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "oer": ["^Wow. There's already an Open Learning Community of Practice, how convenient is that! I'll go and talk to them and learn how other academics have incorporated OERs into their course.", "\n", "^That was really inspiring but I still feel unsure about the best way to go about this whole business however I did learn that the library offers all kinds of support.", "\n", ["ev", "str", "^I'll find out how the library can help", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library" }, "\n", { "#f": 7 }] }], ["ev", "str", "^I think I'll stop my OER foray here - it's too much hassel", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.waste" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "library": [["^The library are fantastic! Look at all the work they are doing to encourage the use of OERs.", "\n", [["ev", "str", "^Grants to help academics make the switch", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.grants" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Assistance with finding and curating OERs", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_finding" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Education and advice on copyright and licencing issues", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.copyright" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Publishing support for the creation of OERs", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.publishing" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^A repository to manage OERs used and created at the University", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.repository" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Financial support for third party OER initiatives", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.initiatives" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Advocacy and policy development", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.advocacy" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], { "#f": 7, "#n": "opts" }], { "loop": [["G>", ["ev", "visit", 6, "MIN", "/ev", "ev", "du", 0, "==", "/ev", { "->": ".^.s0", "c": true }, "ev", "du", 1, "==", "/ev", { "->": ".^.s1", "c": true }, "ev", "du", 2, "==", "/ev", { "->": ".^.s2", "c": true }, "ev", "du", 3, "==", "/ev", { "->": ".^.s3", "c": true }, "ev", "du", 4, "==", "/ev", { "->": ".^.s4", "c": true }, "ev", "du", 5, "==", "/ev", { "->": ".^.s5", "c": true }, "ev", "du", 6, "==", "/ev", { "->": ".^.s6", "c": true }, "nop", { "s0": ["pop", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s1": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s2": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s3": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s4": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s5": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s6": ["pop", "^ ", { "->": "academic.view_results" }, { "->": ".^.^.47" }, null], "#f": 5 }], "G<", null], "\n", { "#f": 7 }] }], { "#f": 3 }], "view_results": ["^Actually that's quiet a lot of things the library is already doing. Maybe I should just give them a break and check on how my students are doing.", "\n", ["ev", "str", "^View your students results", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "grants": ["^They've just launched this new grant program where I can apply for funding to help me with the OER transition.", "\n", "^It's not a lot of money, around $1000, but it is some incentive to put in the time to think about the resources I'm currently using and to find some alternatives.", "\n", "^If I'm really enthusiastic and want to create my own OER textbook then I can apply for a bigger grant of up to $10 000.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "oer_finding": ["^I want to incorporate at least some OERs into my course but how?", "\n", "^It's a good thing the library have fantastic liaison librarians who know where to find relevant OERs. I'm going to use their expertise to get started.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "copyright": ["^I was bit apprehensive about using and creating OERs since I don't want to get into trouble with copyright but the library assisted with that as well!", "\n", "^They have this person who can specifically help with copyright and knows all about Creative Commons licences.", "\n", "^Although all the examples she uses tend to be skewed towards bunnies which can be a bit annoying but apart from that she's okay.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "publishing": ["^I really like the idea of developing my own OER which I can then share with the world.", "\n", "^The library have provided me with a grant to help with the developement and also linked me up with educational designers, librarians and the University Press so I've been able to create professional resources.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "repository": ["^They look after a respository which manages all of the OER which has been used or created in the University.", "\n", "^This means I don't have to worry about OER which I've adopted  disappearing from the original source and all the versions of adapted or remixed OERs are kept for reference.", "\n", "^It's also super useful for seeing what other people in the University have created or are using and I've gotten some great ideas.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "initiatives": ["^It turns out that the library aren't just trying to encourage the use of OER so they don't have to spend money on resources.", "\n", "^They financially support OER initiatives such as Knowledge Unlatched which helps fund the release of monographs under an open licence.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "advocacy": ["^The library have talked to lots of people about OERs and the role they could play at the University.", "\n", "^They've got buy in across the University including from the DVC(A), PVC(SL), Faculty Deans and Heads of Schools.", "\n", "^They've developed a policy that enables OERs to be adopted and adapted easily as well as procedures around the release of created OERs.", "\n", ["ev", "str", "^I wonder what else they can do?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.library.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That's great but I just want to see how my students are doing", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "oer_results": ["^It turns out that using OERs have had a positive effect on my course. I've noticed that there has been an overall improvement in grades and retention.", "\n", "^According to my SELT feedback I've improved in the \"uses appropriate online resources and technologies\" category and students have commented that they appreciate not having to spend large amounts of money on textbooks.", "\n", "^Next time I'm going to get students to find, adapt or create an OER as a part of their assessment and see if I can improve on the other SELT categories.", "\n", ["ev", "str", "^Is that the end?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "#f": 3 }], "librarian": ["^Using my librarian super power of observation I've noticed that textbooks can be really expensive.", "\n", "^This has a big effect on students who might not be able to afford them and can negatively influence results and retention.", "\n", "^It also effects the library since we only provide limited number of textbooks which can prove frustrating to students who rely on them.", "\n", "^I wonder if OERs could be a possible solution?", "\n", ["ev", "str", "^What's happening in the University at the moment?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.university_research" }, "\n", { "#f": 7 }] }], ["ev", "str", "^What have other libraries done?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.other_libraries" }, "\n", { "#f": 7 }] }], ["ev", "str", "^What resources are available?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources" }, "\n", { "#f": 7 }] }], { "university_research": ["^It seems like it would be a good idea if we understood what types of resources academics are currently using and how they go about finding and selecting them.", "\n", ["ev", "str", "^Maybe we could do some research?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.research" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Oh well, I guess we'll never know", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.no_research" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "research": ["^Let's ask academics what they're currently using and why.", "\n", "^We can also analyse available information sources, such as the textbook list provided by the Co-op, the high-use collection holdings and loan statistics, as well as learning resources listed on Course Outlines and MyUni to get a better understanding about the current state of affairs.", "\n", "^We might even find academics who are already using OERs. Maybe if we understand what motivated them to adopt OERs it will help us plan how to best encourage other academics to make the switch.", "\n", "^Now we've got a better understanding of our academics and their mysterious ways!", "\n", ["ev", "str", "^We can investigate if ideas other libraries have implemented would work here", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries" }, "\n", { "#f": 7 }] }], ["ev", "str", "^We can co-opt resources we currently have to do our bidding", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "no_research": ["^That's a nice thought but academics are mysterious creatures who we will never understand.", "\n", "^We'll just have to plunge on ahead with no evidence base to make our decisions.", "\n", ["ev", "str", "^Let's steal ideas from other libraries", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Let's use the resources we have available", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "other_libraries": [["^Different ways other libraries support the use of OERs include...", "\n", [["ev", "str", "^Administering grants to help academics make the switch", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.grant" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Finding and curating OERs for courses", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.finding" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Educating academics on copyright and licencing issues", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.education" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Providing publishing support for the creation of OERs", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.publishing" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Managing a repository to look after all the OER used and created at the University", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.repository" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Financially supporting third party OER initiatives", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.initiatives" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Advocating for OER use and providing policy development to faciliate uptake", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.advocacy" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], { "#f": 7, "#n": "opts" }], { "loop": [["G>", ["ev", "visit", 6, "MIN", "/ev", "ev", "du", 0, "==", "/ev", { "->": ".^.s0", "c": true }, "ev", "du", 1, "==", "/ev", { "->": ".^.s1", "c": true }, "ev", "du", 2, "==", "/ev", { "->": ".^.s2", "c": true }, "ev", "du", 3, "==", "/ev", { "->": ".^.s3", "c": true }, "ev", "du", 4, "==", "/ev", { "->": ".^.s4", "c": true }, "ev", "du", 5, "==", "/ev", { "->": ".^.s5", "c": true }, "ev", "du", 6, "==", "/ev", { "->": ".^.s6", "c": true }, "nop", { "s0": ["pop", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s1": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s2": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s3": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s4": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s5": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.47" }, null], "s6": ["pop", "^ ", { "->": "librarian.view_results" }, { "->": ".^.^.47" }, null], "#f": 5 }], "G<", null], "^", "\n", { "#f": 7 }] }], { "#f": 3 }], "view_results": ["^Actually that's quiet a lot of initiatives other libraries have already tried.", "\n", ["ev", "str", "^I'd like to know how any of these would help students", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "grant": ["^Inviting academics to apply for grants to help with the initial switch has been commonly used.", "\n", "^It's not usually a lot of money, usually around $1000, but it could be enough to encourage academics who are thinking about trying them out.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "finding": ["^Projects which utilise librarians search skills to systematically work through courses and identify content which might be replaced by OERs.", "\n", "^These are generally driven from another area of the University and are often from the result of student advocacy.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "education": ["^Providing education and support around copyright and licencing issues and raising staff capacity around OERs so they feel confident in both their use and creation.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "publishing": ["^Offering publishing support for academics who want to write their own OER textbook.", "\n", "^This can be associated with a decent sized grant, e.g. up to $10 000, to provide academics some compensation for their time and effort.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "repository": ["^Utilising the metadata wizardry and collecting instinct of library staff to manage OERs which have been both used and created at the University.", "\n", "^This keeps them safe and ensures that they are discoverable.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "initiatives": ["^Diverting a small portion of their monograph acquisitions budget to an OER initiative is an easy way libraries can show support.", "\n", "^27 other Australian University Libraries have pledged money to Knowledge Unlatched to facilitate the release of books under an open licence.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "advocacy": ["^Spreading the word about OERs to academics and University leaders to encourage both individual uptake and institutional support for their use.", "\n", "^This includes supporting policies which will reward use and making sure that there are procedures in place so that release of OERs don't conflict with existing Intellectual Property Policies.", "\n", ["ev", "str", "^That sounds promising but what else have other libraries tried?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.other_libraries.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay but how will this help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.oer_results" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "oer_results": ["^Many of these initiatives have resulted in increased student retention, similar or better grades recorded, and decreased financial costs on students.", "\n", ["ev", "str", "^Is this thing ever going to end?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "#f": 3 }], "resources": [["^Let's look at all the resources we already have available to us that could be harnessed for the good of the cause!", "\n", [["ev", "str", "^Liaison Librarians", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources.liaison" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Copyright know how", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources.copyright" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Metadata and repository expertise", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources.metadata" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^University Press", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources.press" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Relationships with stakeholders", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "resources.relationships" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], { "#f": 7, "#n": "opts" }], { "loop": [["G>", ["ev", "visit", 4, "MIN", "/ev", "ev", "du", 0, "==", "/ev", { "->": ".^.s0", "c": true }, "ev", "du", 1, "==", "/ev", { "->": ".^.s1", "c": true }, "ev", "du", 2, "==", "/ev", { "->": ".^.s2", "c": true }, "ev", "du", 3, "==", "/ev", { "->": ".^.s3", "c": true }, "ev", "du", 4, "==", "/ev", { "->": ".^.s4", "c": true }, "nop", { "s0": ["pop", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.35" }, null], "s1": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.35" }, null], "s2": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.35" }, null], "s3": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.35" }, null], "s4": ["pop", "^ ", { "->": "resources.results" }, { "->": ".^.^.35" }, null], "#f": 5 }], "G<", null], "\n", { "#f": 7 }] }], { "results": ["^Actually that's quiet a lot of resources which we already have.", "\n", ["ev", "str", "^How will these actually help students?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "liaison": ["^We have librarians with magical search skills who can find and curate OERs relevant to specific courses.", "\n", "^They can also help teach academics and students about how to search and evaluate OERs for themselves.", "\n", ["ev", "str", "^Okay, but what other resources can we bend to our will?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^How will this help students though?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "copyright": ["^We have this strange person who knows about copyright, is enthusiastic about open licences and spends far too much time reading the terms and conditions of things.", "\n", "^They can help other people learn about these things as well so they feel confident knowing when and how they can use OERs.", "\n", ["ev", "str", "^Okay, but what other resources can we bend to our will?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^How will this help students though?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "metadata": ["^We have a special class of detail orientated people who understand the mysteries of metadata and are good at storing stuff for safe keeping and discovery.", "\n", ["ev", "str", "^Okay, but what other resources can we bend to our will?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^How will this help students though?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "press": ["^We have professional publishing people who know the business.", "\n", "^They can make things look pretty and know the difference between licence and license.", "\n", ["ev", "str", "^Okay, but what other resources can we bend to our will?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^How will this help students though?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "relationships": ["^We have networks with other people and areas of the University which can contribute to facilitating uptake of OER use.", "\n", "^We also have close contact with students and can involve them in the conversation and advocacy around the adoption of OERs.", "\n", ["ev", "str", "^Okay, but what other resources can we bend to our will?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.0.loop" }, "\n", { "#f": 7 }] }], ["ev", "str", "^How will this help students though?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.view" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "view": ["^A lot of these match up with initiatives other libraries have tried.", "\n", "^If we implemented some of them then we should see increased student retention, same or better grades and decreased costs.", "\n", ["ev", "str", "^I'd like to know more about these initiatives", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian.other_libraries" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Okay I believe you can I skip to the end now?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "#f": 3 }], "executive": ["^Hello important library executive, as you know one of the recommendations of the Library of the Future report was:", "\n", "^\"The Libraries will lead and partner in open educational resources access and (re)use for learning and teaching\"", "\n", ["ev", "str", "^This is a great objective to have but how can it be implemented in reality?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.implementation" }, "\n", { "#f": 7 }] }], { "implementation": [["^There's not one single idea which is going to achieve this but we should consider the following when developing an OER strategy:", "\n", [["ev", "str", "^Research", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "executive.research" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Advocacy", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "executive.advocacy" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], ["ev", "str", "^Support", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "executive.support" }, "\n", { "->": ".^.^.^.^.loop" }, { "#f": 7 }] }], { "#f": 7, "#n": "opts" }], { "loop": [["G>", ["ev", "visit", 2, "MIN", "/ev", "ev", "du", 0, "==", "/ev", { "->": ".^.s0", "c": true }, "ev", "du", 1, "==", "/ev", { "->": ".^.s1", "c": true }, "ev", "du", 2, "==", "/ev", { "->": ".^.s2", "c": true }, "nop", { "s0": ["pop", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.23" }, null], "s1": ["pop", "^ ", { "->": ".^.^.^.^.^.opts" }, { "->": ".^.^.23" }, null], "s2": ["pop", "^ ", { "->": "executive.no_options" }, { "->": ".^.^.23" }, null], "#f": 5 }], "G<", null], "\n", { "#f": 7 }] }], { "#f": 3 }], "research": ["^A lot of research has already been done around OERs (more on this when you reach the end).", "\n", "^We can use this but wouldn't it be nice to base our decisions on what's going on at our University in particular?", "\n", ["ev", "str", "^Nope, seems like a waste of time", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.research_no" }, "\n", { "#f": 7 }] }], ["ev", "str", "^Yep, that does sound good", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.research_yes" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "research_no": ["^Well, we could proceed forward regardless and hope for the best.", "\n", ["ev", "str", "^If you don't want to do any research you should probably consider the other factors", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.implementation.0.loop" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "research_yes": ["^That sounds like a great idea. Think about how much more effective we could be if we knew the following:", "\n", "^> What resources students want and the impact selection can have on student success, e.g. grades, retention, vitamin C intake.", "\n", "^> What resources academics are currently using and how and why they choose them.", "\n", "^> What incentives would be necessary to encourage academics to use OERs.", "\n", "^> Are there any academics already using OERs and if so what's their motivation.", "\n", "^> If data inform us about where to concentrate our efforts, e.g. loan statistics, textbook costs, student numbers, retention and grades, SELT feedback.", "\n", ["ev", "str", "^That will be a piece of cake. What else did we need to consider?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.implementation.0.loop" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "advocacy": ["^It's nice that the library likes the idea of OERs but we should probably include other people in the conversation and get buy in across the University.", "\n", ["ev", "str", "^Don't be silly. We're the most important part of the University and others will bow to our commands.", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.advocacy_commands" }, "\n", { "#f": 7 }] }], ["ev", "str", "^That makes sense. We're going to need all the help and support we can get", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.advocacy_help" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "advocacy_commands": ["^Umm. You might be slightly deluded if you think the library is all great and powerful and can dictate how other people will behave. Good luck to you.", "\n", ["ev", "str", "^Maybe you should look at the other factors to consider.", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.implementation.0.loop" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "advocacy_help": ["^Yes, we should definately do that. We can involve:", "\n", "^> Students", "\n", "^Since this is aimed towards reducing expense for them, improving the teaching and learning experience, and equiping them with the digital skills they'll require we should probably get their input.", "\n", "^In fact in some cases it's been demands from students for their institution to address rising costs that has been the catalyst for the implementation of OER projects.", "\n", "^> Academics", "\n", "^Given that this has the potential to change academics teaching and learning practices we should make sure it's a positive change.", "\n", "^We need to be clear about the benefits of OER while acknowledging that for some academics it may be more difficult and time consuming to implement.", "\n", "^Finding academics who are already using OER or are interested in using them would be a great place to start as there is the potential they could become powerful practitioner advocates.", "\n", "^> Professional staff", "\n", "^Most academics are going to require support from various professional staff so they should be involved from the beginning and given the opportunity for capacity building.", "\n", "^We can start with staff within the library but should also include people such as educational technologists and designers but really we need to include absolutely anybody else who shows an interest.", "\n", "^> University leadership", "\n", "^While talking to students, academics and professional staff is important if we want significant change we're going to need to convince those in higher places.", "\n", "^They have the power to provide incentives, such as recognising the use of OER in teaching reviews and funding projects to adopt or create OERs.", "\n", "^They may also be required to approve policies to facilitate the release of OERs so that this doesn't conflict with existing ownership principles.", "\n", ["ev", "str", "^Let's assume they're all on board. What else do we need to consider?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.implementation.0.loop" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "support": ["^If the library is serious about this whole OER thing then we should think about providing some incentives and practical support.", "\n", ["ev", "str", "^That sounds like a lot of effort and I'm tired", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.support_no" }, "\n", { "#f": 7 }] }], ["ev", "str", "^What sort of support are you suggesting?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.support_yes" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "support_no": ["^We don't have to do anything if you insist but I don't think we're going to achieve the recommendation.", "\n", ["ev", "str", "^Was there any of the other factors you needed to consider?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.implementation.0.loop" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "support_yes": ["^There are lots of ways we could do this, such as:", "\n", "^> Awarding grants", "\n", "^This could be a relatively small amount (~ $1000) for academics wishing to adopt or adapt an OER to more significant amounts (~ $10 000) for academics who want to create their own OER textbook.", "\n", "^> Helping find and curate OERs for specific courses", "\n", "^With academics identify the concepts that need to be covered and library staff curating potential resources, possibly in collaboration with a learning designer. Academics interested in using OERs could self-select or the library could approach academics when we know a large impact could be made.", "\n", "^> Providing publishing support", "\n", "^This could be in conjunction with grants for creating OER textbooks. Where appropriate it would also include using pre-exisiting OERs so could cross over with finding and curating help.", "\n", "^> Educating and advicing on copyright and licencing issues", "\n", "^Yes, I know this is my job but I'm hardly going to leave myself out of the story.", "\n", "^> Repository and metadata management", "\n", "^We should be managing OERs which are used and created at the University so others can find and use them.", "\n", "^This could be achieved by using one of our existing systems as a repository or implementing something new. It also requires applying appropriate metadata and version control.", "\n", "^> Financially supporting third party initiatives", "\n", "^We could divert a small portion of our monograph budget to initiatives such as Knowledge Unlatched. This would be very little effort and money but would signal our committment to open principles.", "\n", ["ev", "str", "^What other factors do you need to consider?", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.^.implementation.0.loop" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "no_options": ["^Actually, that's everything to consider for now.", "\n", { "->": ".^.^.boring" }, { "#f": 3 }], "boring": ["^You've probably got the point but it might have been a bit boring. You might prefer playing as someone else:", "\n", ["ev", "str", "^The most enthusiatic student in the world.", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "student" }, "\n", { "#f": 7 }] }], ["ev", "str", "^An OER curious academic.", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "academic" }, "\n", { "#f": 7 }] }], ["ev", "str", "^A librarian with lots of ideas for encouraging the use of OERs.", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "librarian" }, "\n", { "#f": 7 }] }], ["ev", "str", "^No, I have no desire to be stuck in a loop. Please let me finish.", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": "evidence" }, "\n", { "#f": 7 }] }], { "#f": 3 }], "#f": 3 }], "evidence": ["^Well that was interesting but it was pretty dodgy as far as choose your own adventure stories go.", "\n", "^What about some evidence to back that up?", "\n", ["ev", "str", "^Okay. Here you go...", "/str", "/ev", { "*": ".^.c", "flg": 20 }, { "c": ["\n", { "->": ".^.^.^.bibliography" }, "\n", { "#f": 7 }] }], { "bibliography": ["^Anderson, Talea, Annie Gaines, Chelsea Leachman & Evan Peter Williamson (2017) Faculty and Instructor Perceptions of Open Educational Resources in Engineering. The Reference Librarian. 58(4), 257-277", "\n", "^Blessinger, Patrick & TJ Bliss (eds) (2016) Open Education: International Perspectives in Higher Education. Open Book Publishers", "\n", "^Bossu, Carina, Mark Brown & David Bull(2011) Playing catch-up: investigating public and institutional policies for OER practices in Australia. Journal of Open, Flexible and Distance Education. 15(2), 41-54", "\n", "^Colson, Robin, Elijah Scott & Robin Donaldson (2017) Supporting librarians in making the business case for OER. The Reference Librarian. 58(4), 278-287", "\n", "^Conole, Grinne, Giles Pepler, Paul Bacsich, Brenda Padilla & Terese Bird (2016) Promoting Policy Uptake for Open Educational Resources and Open Practices in The SAGE Handbook of E-learning Research London: Sage, 443-468", "\n", "^Cronin, Catherine (2017) Openness and Praxis: Exploring the Use of Open Educational Practices in Higher Education. International Review of Research in Open and Distributed Learning. 18(5), 15-34", "\n", "^Ferguson, Christine (2017) Open Educational Resources and Institutional Repositories. Serials Review. 43(1), 34-38", "\n", "^Guibault, Lucie & Christina Angelopoulos (eds) (2011) Open Content Licensing: From Theory to Practice. Amsterdam: Amsterdam University Press", "\n", "^Hess, Julia, Alejandra Nann & Kelly Riddle (2017) Navigating OER: the library's role in bringing OER to campus.The Serials Librarian. 70(1-4), 128-134", "\n", "^Jhangiani, Rajiv, Rebecca Pitt, Christina Hendricks, Jessie Key & Clint Lalonde (2016) Exploring Faculty Use of Open Educational Resources at British Columbia Post-Secondary Institutions. Victoria, British Columbia: BC Campus", "\n", "^Jhangiani, Rajiv & Robert Biswas-Diener (eds) (2017) Open: the Philosophy and Practices that are Revolutionizing Education and Science London: Ubiquity Press", "\n", "^Kaatrakoski, Heli, Allison Littlejohn & Nina Hood (2017) Learning challenges in higher education: an analysis of contradictions within Open Educational Practice. Higher Education. 74(4), 599-615", "\n", "^Nascimbeni, Fabio & Daniel Burgos (2016) In Search for the Open Educator: Proposal of a Definition and a Framework to Increase Openness Adoption Among University Educators. International Review of Research in Open and Distributed Learning. 17(6),", "\n", "^Miao, Fengchun, Sanjaya Mishra & Rory McGreal (eds) (2016) Open Educational Resources: Policy, Costs and Transformation. Paris: UNESCO & Commonwealth of Learning", "\n", "^Miller, Robert & Lindley Homol (2016) Building an Online Curriculum Based on OERs: The Library's Role. Journal of Library & Information Services in Distance Learning. 10(3-4), 349-359", "\n", "^Orr, Dominic, Michele Rimini & Dirk Van Damme (2015) Open Educational Resources: A Catalyst for Innovation. Paris: OECD Publishing", "\n", "^Ozdemir, Ozgur & Christina Hendricks (2017) Instructor and student experiences with open textbooks, from the California open online library for education (Cool4Ed). Journal of Computing in Higher Education 29(1), 98-113", "\n", "^Peres, Jorge Enrique (2017) Images and the Open Educational Resources (OER) Movement. The Reference Librarian. 58(4), 229-237", "\n", "^Pierce, Matthew (2016) Looking at OER with a Critical Eye: Strengthening OER Initiatives by Focusing on Student Learning. Community & Junior College Libraries. 22(1-2), 11-17", "\n", "^Pitt, Rebecca (2015) Mainstreaming open textbooks: educator perspectives on the impact of OpenStax college open textbooks. International Review of Research in Open and Distributed Learning. 16(4), 133-155", "\n", "^Salem, Joseph (2017) Open Pathways to Student Success: Academic Library Partnerships for Open Educational Resource and Affordable Course Content Creation and Adoption. The Journal of Academic Librarianship. 43(1), 34-38", "\n", "^Santos-Hermosa, Gema, Núria Ferran-Ferrer & Ernest Abadal (2017) Repositories of Open Educational Resources: An Assessment of Reuse and Educational Aspects. International Review of Research in Open and Distributed Learning. 18(5), 84-120", "\n", "^Smith, Brenda (2017) Librarians and OER: Cultivating a Community of Practice To Be More Effective Advocates. Journal of Library & Information Services in Distance Learning. 11(1-2), 106-122", "\n", "^Stevens, Jessica, Stephanie Bradbury & Sue Hutley (2017) Open Education in Practice – How Policy Can Lead to Positive Change. Journal of the Australian Library and Information Association. 66(3), 249-258", "\n", "^Thompson, Sydney, William Cross, Lillian Rigling & John Vickery (2017) Data-informed open education advocacy: a new approach to saving students money and backaches. Journal of Access Services. 14(3), 118-125", "\n", "^Veletsianos, George (2015) A case study of scholars' open and sharing practices. Open Praxis. 7(3), 199-209.", "\n", "^Walz, Anita, Kristi Jensen, & Joseph A. Salem (2016) Affordable Course Content and Open Educational Resources. SPEC Kit 351. Washington, DC: Association of Research Libraries", "\n", "^Wiley, David, TJ Bliss & Mary McEwen (2014) Open education resources: a review of the literature. Handbook of Research on Educational Communications and Technology New York: Springer, 781-789", "\n", "end", { "#f": 3 }], "#f": 3 }], "#f": 3 }], "listDefs": {} };s
    </script>
    <!-- main.js -->
    <script language="javascript" type="text/javascript">
        // main.js
        (function (storyContent) {
            var story = new inkjs.Story(storyContent);
            var storyContainer = document.querySelectorAll('#story')[0];
            function showAfter(delay, el) {
                setTimeout(function () {
                    el.classList.add("show")
                }, delay);
            }
            function scrollToBottom() {
                var progress = 0.0;
                var start = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
                var dist = document.body.scrollHeight - window.innerHeight - start;
                if (dist < 0) return;
                var duration = 300 + 300 * dist / 100;
                var startTime = null;
                function step(time) {
                    if (startTime == null) startTime = time;
                    var t = (time - startTime) / duration;
                    var lerp = 3 * t * t - 2 * t * t * t;
                    window.scrollTo(0, start + lerp * dist);
                    if (t < 1) requestAnimationFrame(step);
                }
                requestAnimationFrame(step);
            }
            function continueStory() {
                var paragraphIndex = 0;
                var delay = 0.0;
                // Generate story text - loop through available content
                while (story.canContinue) {
                    // Get ink to generate the next paragraph
                    var paragraphText = story.Continue();
                    // Create paragraph element
                    var paragraphElement = document.createElement('p');
                    paragraphElement.innerHTML = paragraphText;
                    storyContainer.appendChild(paragraphElement);
                    // Fade in paragraph after a short delay
                    showAfter(delay, paragraphElement);
                    delay += 200.0;
                }
                // Create HTML choices from ink choices
                story.currentChoices.forEach(function (choice) {
                    // Create paragraph with anchor element
                    var choiceParagraphElement = document.createElement('p');
                    choiceParagraphElement.classList.add("choice");
                    choiceParagraphElement.innerHTML = `<a href='#'>${choice.text}</a>`
                    storyContainer.appendChild(choiceParagraphElement);
                    // Fade choice in after a short delay
                    showAfter(delay, choiceParagraphElement);
                    delay += 200.0;
                    // Click on choice
                    var choiceAnchorEl = choiceParagraphElement.querySelectorAll("a")[0];
                    choiceAnchorEl.addEventListener("click", function (event) {
                        // Don't follow <a> link
                        event.preventDefault();
                        // Remove all existing choices
                        var existingChoices = storyContainer.querySelectorAll('p.choice');
                        for (var i = 0; i < existingChoices.length; i++) {
                            var c = existingChoices[i];
                            c.parentNode.removeChild(c);
                        }
                        // Tell the story where to go next
                        story.ChooseChoiceIndex(choice.index);
                        // Aaand loop
                        continueStory();
                    });
                });
                scrollToBottom();
            }
            continueStory();
        })(storyContent);
    </script>
</body>

</html>